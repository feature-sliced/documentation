"use strict";(self.webpackChunk_feature_sliced_documentation=self.webpackChunk_feature_sliced_documentation||[]).push([["91"],{1131:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>o,default:()=>u,toc:()=>d,metadata:()=>i,assets:()=>a,contentTitle:()=>c});var i=JSON.parse('{"id":"guides/tech/with-react-query","title":"S\u1EED d\u1EE5ng v\u1EDBi React Query","description":"V\u1EA5n \u0111\u1EC1 \\"n\xean \u0111\u1EB7t c\xe1c key \u1EDF \u0111\xe2u\\"","source":"@site/i18n/vi/docusaurus-plugin-content-docs/current/guides/tech/with-react-query.mdx","sourceDirName":"guides/tech","slug":"/guides/tech/with-react-query","permalink":"/documentation/vi/docs/guides/tech/with-react-query","draft":false,"unlisted":false,"editUrl":"https://github.com/feature-sliced/documentation/edit/master/i18n/vi/docusaurus-plugin-content-docs/current/guides/tech/with-react-query.mdx","tags":[],"version":"current","lastUpdatedAt":1757626519000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"docsSidebar","previous":{"title":"S\u1EED d\u1EE5ng v\u1EDBi NuxtJS","permalink":"/documentation/vi/docs/guides/tech/with-nuxtjs"},"next":{"title":"S\u1EED d\u1EE5ng v\u1EDBi SvelteKit","permalink":"/documentation/vi/docs/guides/tech/with-sveltekit"}}'),s=t(4132),r=t(9447);let o={sidebar_position:10},c="S\u1EED d\u1EE5ng v\u1EDBi React Query",a={},d=[{value:"V\u1EA5n \u0111\u1EC1 &quot;n\xean \u0111\u1EB7t c\xe1c key \u1EDF \u0111\xe2u&quot;",id:"v\u1EA5n-\u0111\u1EC1-n\xean-\u0111\u1EB7t-c\xe1c-key-\u1EDF-\u0111\xe2u",level:2},{value:"Gi\u1EA3i ph\xe1p \u2014 ph\xe2n chia theo entities",id:"gi\u1EA3i-ph\xe1p--ph\xe2n-chia-theo-entities",level:3},{value:"Gi\u1EA3i ph\xe1p thay th\u1EBF \u2014 gi\u1EEF trong shared",id:"gi\u1EA3i-ph\xe1p-thay-th\u1EBF--gi\u1EEF-trong-shared",level:3},{value:"V\u1EA5n \u0111\u1EC1 &quot;\u0110\u1EB7t mutations \u1EDF \u0111\xe2u?&quot;",id:"v\u1EA5n-\u0111\u1EC1-\u0111\u1EB7t-mutations-\u1EDF-\u0111\xe2u",level:2},{value:"1. \u0110\u1ECBnh ngh\u0129a m\u1ED9t custom hook trong segment <code>api</code> g\u1EA7n n\u01A1i s\u1EED d\u1EE5ng",id:"1-\u0111\u1ECBnh-ngh\u0129a-m\u1ED9t-custom-hook-trong-segment-api-g\u1EA7n-n\u01A1i-s\u1EED-d\u1EE5ng",level:3},{value:"2. \u0110\u1ECBnh ngh\u0129a m\u1ED9t mutation function \u1EDF n\u01A1i kh\xe1c (Shared ho\u1EB7c Entities) v\xe0 s\u1EED d\u1EE5ng <code>useMutation</code> tr\u1EF1c ti\u1EBFp trong component",id:"2-\u0111\u1ECBnh-ngh\u0129a-m\u1ED9t-mutation-function-\u1EDF-n\u01A1i-kh\xe1c-shared-ho\u1EB7c-entities-v\xe0-s\u1EED-d\u1EE5ng-usemutation-tr\u1EF1c-ti\u1EBFp-trong-component",level:3},{value:"T\u1ED5 ch\u1EE9c c\xe1c request",id:"t\u1ED5-ch\u1EE9c-c\xe1c-request",level:2},{value:"Query factory",id:"query-factory",level:3},{value:"1. T\u1EA1o m\u1ED9t Query Factory",id:"1-t\u1EA1o-m\u1ED9t-query-factory",level:3},{value:"2. S\u1EED d\u1EE5ng Query Factory trong code \u1EE9ng d\u1EE5ng",id:"2-s\u1EED-d\u1EE5ng-query-factory-trong-code-\u1EE9ng-d\u1EE5ng",level:3},{value:"L\u1EE3i \xedch c\u1EE7a vi\u1EC7c s\u1EED d\u1EE5ng Query Factory",id:"l\u1EE3i-\xedch-c\u1EE7a-vi\u1EC7c-s\u1EED-d\u1EE5ng-query-factory",level:3},{value:"Ph\xe2n trang",id:"ph\xe2n-trang",level:2},{value:"1. T\u1EA1o function <code>getPosts</code>",id:"1-t\u1EA1o-function-getposts",level:3},{value:"2. Query factory cho ph\xe2n trang",id:"2-query-factory-cho-ph\xe2n-trang",level:3},{value:"3. S\u1EED d\u1EE5ng trong code \u1EE9ng d\u1EE5ng",id:"3-s\u1EED-d\u1EE5ng-trong-code-\u1EE9ng-d\u1EE5ng",level:3},{value:"<code>QueryProvider</code> \u0111\u1EC3 qu\u1EA3n l\xfd queries",id:"queryprovider-\u0111\u1EC3-qu\u1EA3n-l\xfd-queries",level:2},{value:"1. T\u1EA1o m\u1ED9t <code>QueryProvider</code>",id:"1-t\u1EA1o-m\u1ED9t-queryprovider",level:3},{value:"2. T\u1EA1o m\u1ED9t <code>QueryClient</code>",id:"2-t\u1EA1o-m\u1ED9t-queryclient",level:3},{value:"T\u1EF1 \u0111\u1ED9ng sinh code",id:"t\u1EF1-\u0111\u1ED9ng-sinh-code",level:2},{value:"L\u1EDDi khuy\xean b\u1ED5 sung cho vi\u1EC7c t\u1ED5 ch\u1EE9c RQ",id:"l\u1EDDi-khuy\xean-b\u1ED5-sung-cho-vi\u1EC7c-t\u1ED5-ch\u1EE9c-rq",level:2},{value:"API Client",id:"api-client",level:3},{value:"Xem th\xeam",id:"see-also",level:2}];function l(n){let e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"s\u1EED-d\u1EE5ng-v\u1EDBi-react-query",children:"S\u1EED d\u1EE5ng v\u1EDBi React Query"})}),"\n",(0,s.jsx)(e.h2,{id:"v\u1EA5n-\u0111\u1EC1-n\xean-\u0111\u1EB7t-c\xe1c-key-\u1EDF-\u0111\xe2u",children:'V\u1EA5n \u0111\u1EC1 "n\xean \u0111\u1EB7t c\xe1c key \u1EDF \u0111\xe2u"'}),"\n",(0,s.jsx)(e.h3,{id:"gi\u1EA3i-ph\xe1p--ph\xe2n-chia-theo-entities",children:"Gi\u1EA3i ph\xe1p \u2014 ph\xe2n chia theo entities"}),"\n",(0,s.jsx)(e.p,{children:"N\u1EBFu d\u1EF1 \xe1n \u0111\xe3 c\xf3 s\u1EF1 ph\xe2n chia th\xe0nh c\xe1c entity, v\xe0 m\u1ED7i request t\u01B0\u01A1ng \u1EE9ng v\u1EDBi m\u1ED9t entity duy nh\u1EA5t,\nc\xe1ch ph\xe2n chia thu\u1EA7n khi\u1EBFt nh\u1EA5t s\u1EBD l\xe0 theo entity. Trong tr\u01B0\u1EDDng h\u1EE3p n\xe0y, ch\xfang t\xf4i \u0111\u1EC1 xu\u1EA5t s\u1EED d\u1EE5ng c\u1EA5u tr\xfac sau:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"\u2514\u2500\u2500 src/                                        #\n    \u251C\u2500\u2500 app/                                    #\n    |   ...                                     #\n    \u251C\u2500\u2500 pages/                                  #\n    |   ...                                     #\n    \u251C\u2500\u2500 entities/                               #\n    |     \u251C\u2500\u2500 {entity}/                         #\n    |    ...     \u2514\u2500\u2500 api/                       #\n    |                 \u251C\u2500\u2500 `{entity}.query`      # Query-factory n\u01A1i ch\u1EE9a c\xe1c key v\xe0 function\n    |                 \u251C\u2500\u2500 `get-{entity}`        # Function l\u1EA5y entity\n    |                 \u251C\u2500\u2500 `create-{entity}`     # Function t\u1EA1o entity\n    |                 \u251C\u2500\u2500 `update-{entity}`     # Function c\u1EADp nh\u1EADt entity\n    |                 \u251C\u2500\u2500 `delete-{entity}`     # Function x\xf3a entity\n    |                ...                        #\n    |                                           #\n    \u251C\u2500\u2500 features/                               #\n    |   ...                                     #\n    \u251C\u2500\u2500 widgets/                                #\n    |   ...                                     #\n    \u2514\u2500\u2500 shared/                                 #\n        ...                                     #\n"})}),"\n",(0,s.jsxs)(e.p,{children:["N\u1EBFu c\xf3 k\u1EBFt n\u1ED1i gi\u1EEFa c\xe1c entity (v\xed d\u1EE5, entity Country c\xf3 field-list c\u1EE7a c\xe1c entity City),\nth\xec b\u1EA1n c\xf3 th\u1EC3 s\u1EED d\u1EE5ng ",(0,s.jsx)(e.a,{href:"/docs/reference/public-api#public-api-for-cross-imports",children:"public API for cross-imports"})," ho\u1EB7c c\xe2n nh\u1EAFc gi\u1EA3i ph\xe1p thay th\u1EBF b\xean d\u01B0\u1EDBi."]}),"\n",(0,s.jsx)(e.h3,{id:"gi\u1EA3i-ph\xe1p-thay-th\u1EBF--gi\u1EEF-trong-shared",children:"Gi\u1EA3i ph\xe1p thay th\u1EBF \u2014 gi\u1EEF trong shared"}),"\n",(0,s.jsx)(e.p,{children:"Trong c\xe1c tr\u01B0\u1EDDng h\u1EE3p m\xe0 vi\u1EC7c t\xe1ch bi\u1EC7t entity kh\xf4ng ph\xf9 h\u1EE3p, c\xf3 th\u1EC3 c\xe2n nh\u1EAFc c\u1EA5u tr\xfac sau:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"\u2514\u2500\u2500 src/                                        #\n   ...                                          #\n    \u2514\u2500\u2500 shared/                                 #\n          \u251C\u2500\u2500 api/                              #\n         ...   \u251C\u2500\u2500 `queries`                    # Query-factories\n               |      \u251C\u2500\u2500 `document.ts`         #\n               |      \u251C\u2500\u2500 `background-jobs.ts`  #\n               |     ...                        #\n               \u2514\u2500\u2500  index.ts                    #\n"})}),"\n",(0,s.jsxs)(e.p,{children:["Sau \u0111\xf3 trong ",(0,s.jsx)(e.code,{children:"@/shared/api/index.ts"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",metastring:'title="@/shared/api/index.ts"',children:'export { documentQueries } from "./queries/document";\n'})}),"\n",(0,s.jsx)(e.h2,{id:"v\u1EA5n-\u0111\u1EC1-\u0111\u1EB7t-mutations-\u1EDF-\u0111\xe2u",children:'V\u1EA5n \u0111\u1EC1 "\u0110\u1EB7t mutations \u1EDF \u0111\xe2u?"'}),"\n",(0,s.jsx)(e.p,{children:"Kh\xf4ng n\xean tr\u1ED9n l\u1EABn mutations v\u1EDBi queries. C\xf3 hai l\u1EF1a ch\u1ECDn:"}),"\n",(0,s.jsxs)(e.h3,{id:"1-\u0111\u1ECBnh-ngh\u0129a-m\u1ED9t-custom-hook-trong-segment-api-g\u1EA7n-n\u01A1i-s\u1EED-d\u1EE5ng",children:["1. \u0110\u1ECBnh ngh\u0129a m\u1ED9t custom hook trong segment ",(0,s.jsx)(e.code,{children:"api"})," g\u1EA7n n\u01A1i s\u1EED d\u1EE5ng"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/features/update-post/api/use-update-title.ts"',children:"export const useUpdateTitle = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: ({ id, newTitle }) =>\n      apiClient\n        .patch(`/posts/${id}`, { title: newTitle })\n        .then((data) => console.log(data)),\n\n    onSuccess: (newPost) => {\n      queryClient.setQueryData(postsQueries.ids(id), newPost);\n    },\n  });\n};\n"})}),"\n",(0,s.jsxs)(e.h3,{id:"2-\u0111\u1ECBnh-ngh\u0129a-m\u1ED9t-mutation-function-\u1EDF-n\u01A1i-kh\xe1c-shared-ho\u1EB7c-entities-v\xe0-s\u1EED-d\u1EE5ng-usemutation-tr\u1EF1c-ti\u1EBFp-trong-component",children:["2. \u0110\u1ECBnh ngh\u0129a m\u1ED9t mutation function \u1EDF n\u01A1i kh\xe1c (Shared ho\u1EB7c Entities) v\xe0 s\u1EED d\u1EE5ng ",(0,s.jsx)(e.code,{children:"useMutation"})," tr\u1EF1c ti\u1EBFp trong component"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",children:"const { mutateAsync, isPending } = useMutation({\n  mutationFn: postApi.createPost,\n});\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/pages/post-create/ui/post-create-page.tsx"',children:'export const CreatePost = () => {\n  const { classes } = useStyles();\n  const [title, setTitle] = useState("");\n\n  const { mutate, isPending } = useMutation({\n    mutationFn: postApi.createPost,\n  });\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement>) =>\n    setTitle(e.target.value);\n  const handleSubmit = (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    mutate({ title, userId: DEFAULT_USER_ID });\n  };\n\n  return (\n    <form className={classes.create_form} onSubmit={handleSubmit}>\n      <TextField onChange={handleChange} value={title} />\n      <LoadingButton type="submit" variant="contained" loading={isPending}>\n        Create\n      </LoadingButton>\n    </form>\n  );\n};\n'})}),"\n",(0,s.jsx)(e.h2,{id:"t\u1ED5-ch\u1EE9c-c\xe1c-request",children:"T\u1ED5 ch\u1EE9c c\xe1c request"}),"\n",(0,s.jsx)(e.h3,{id:"query-factory",children:"Query factory"}),"\n",(0,s.jsx)(e.p,{children:"M\u1ED9t query factory l\xe0 m\u1ED9t object m\xe0 c\xe1c gi\xe1 tr\u1ECB key l\xe0 c\xe1c function tr\u1EA3 v\u1EC1 m\u1ED9t danh s\xe1ch c\xe1c query key. \u0110\xe2y l\xe0 c\xe1ch s\u1EED d\u1EE5ng n\xf3:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:'const keyFactory = {\n  all: () => ["entity"],\n  lists: () => [...postQueries.all(), "list"],\n};\n'})}),"\n",(0,s.jsxs)(e.admonition,{type:"info",children:[(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"queryOptions"})," l\xe0 m\u1ED9t utility t\xedch h\u1EE3p s\u1EB5n trong react-query@v5 (t\xf9y ch\u1ECDn)"]}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"queryOptions({\n  queryKey,\n  ...options,\n});\n"})}),(0,s.jsxs)(e.p,{children:['\u0110\u1EC3 c\xf3 type safety t\u1ED1t h\u01A1n, t\u01B0\u01A1ng th\xedch v\u1EDBi c\xe1c phi\xean b\u1EA3n t\u01B0\u01A1ng lai c\u1EE7a react-query, v\xe0 d\u1EC5 d\xe0ng truy c\u1EADp c\xe1c function v\xe0 query key,\nb\u1EA1n c\xf3 th\u1EC3 s\u1EED d\u1EE5ng function queryOptions t\xedch h\u1EE3p s\u1EB5n t\u1EEB "@tanstack/react-query"\n',(0,s.jsx)(e.a,{href:"https://tkdodo.eu/blog/the-query-options-api#queryoptions",children:"(Chi ti\u1EBFt th\xeam t\u1EA1i \u0111\xe2y)"}),"."]})]}),"\n",(0,s.jsx)(e.h3,{id:"1-t\u1EA1o-m\u1ED9t-query-factory",children:"1. T\u1EA1o m\u1ED9t Query Factory"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/entities/post/api/post.queries.ts"',children:'import { keepPreviousData, queryOptions } from "@tanstack/react-query";\nimport { getPosts } from "./get-posts";\nimport { getDetailPost } from "./get-detail-post";\nimport { PostDetailQuery } from "./query/post.query";\n\nexport const postQueries = {\n  all: () => ["posts"],\n\n  lists: () => [...postQueries.all(), "list"],\n  list: (page: number, limit: number) =>\n    queryOptions({\n      queryKey: [...postQueries.lists(), page, limit],\n      queryFn: () => getPosts(page, limit),\n      placeholderData: keepPreviousData,\n    }),\n\n  details: () => [...postQueries.all(), "detail"],\n  detail: (query?: PostDetailQuery) =>\n    queryOptions({\n      queryKey: [...postQueries.details(), query?.id],\n      queryFn: () => getDetailPost({ id: query?.id }),\n      staleTime: 5000,\n    }),\n};\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-s\u1EED-d\u1EE5ng-query-factory-trong-code-\u1EE9ng-d\u1EE5ng",children:"2. S\u1EED d\u1EE5ng Query Factory trong code \u1EE9ng d\u1EE5ng"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",children:'import { useParams } from "react-router-dom";\nimport { postApi } from "@/entities/post";\nimport { useQuery } from "@tanstack/react-query";\n\ntype Params = {\n  postId: string;\n};\n\nexport const PostPage = () => {\n  const { postId } = useParams<Params>();\n  const id = parseInt(postId || "");\n  const {\n    data: post,\n    error,\n    isLoading,\n    isError,\n  } = useQuery(postApi.postQueries.detail({ id }));\n\n  if (isLoading) {\n    return <div>Loading...</div>;\n  }\n\n  if (isError || !post) {\n    return <>{error?.message}</>;\n  }\n\n  return (\n    <div>\n      <p>Post id: {post.id}</p>\n      <div>\n        <h1>{post.title}</h1>\n        <div>\n          <p>{post.body}</p>\n        </div>\n      </div>\n      <div>Owner: {post.userId}</div>\n    </div>\n  );\n};\n'})}),"\n",(0,s.jsx)(e.h3,{id:"l\u1EE3i-\xedch-c\u1EE7a-vi\u1EC7c-s\u1EED-d\u1EE5ng-query-factory",children:"L\u1EE3i \xedch c\u1EE7a vi\u1EC7c s\u1EED d\u1EE5ng Query Factory"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"C\u1EA5u tr\xfac h\xf3a request:"})," Factory cho ph\xe9p b\u1EA1n t\u1ED5 ch\u1EE9c t\u1EA5t c\u1EA3 API request t\u1EA1i m\u1ED9t n\u01A1i, gi\xfap code d\u1EC5 \u0111\u1ECDc v\xe0 b\u1EA3o tr\xec h\u01A1n."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Truy c\u1EADp thu\u1EADn ti\u1EC7n v\xe0o query v\xe0 key:"})," Factory cung c\u1EA5p c\xe1c method thu\u1EADn ti\u1EC7n \u0111\u1EC3 truy c\u1EADp c\xe1c lo\u1EA1i query kh\xe1c nhau v\xe0 key c\u1EE7a ch\xfang."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Kh\u1EA3 n\u0103ng refetch query:"})," Factory cho ph\xe9p refetch d\u1EC5 d\xe0ng m\xe0 kh\xf4ng c\u1EA7n thay \u0111\u1ED5i query key \u1EDF c\xe1c ph\u1EA7n kh\xe1c nhau c\u1EE7a \u1EE9ng d\u1EE5ng."]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"ph\xe2n-trang",children:"Ph\xe2n trang"}),"\n",(0,s.jsxs)(e.p,{children:["Trong ph\u1EA7n n\xe0y, ch\xfang ta s\u1EBD xem x\xe9t v\xed d\u1EE5 v\u1EC1 function ",(0,s.jsx)(e.code,{children:"getPosts"}),", th\u1EF1c hi\u1EC7n API request \u0111\u1EC3 l\u1EA5y c\xe1c post entity s\u1EED d\u1EE5ng ph\xe2n trang."]}),"\n",(0,s.jsxs)(e.h3,{id:"1-t\u1EA1o-function-getposts",children:["1. T\u1EA1o function ",(0,s.jsx)(e.code,{children:"getPosts"})]}),"\n",(0,s.jsxs)(e.p,{children:["Function getPosts n\u1EB1m trong file ",(0,s.jsx)(e.code,{children:"get-posts.ts"}),", \u0111\u01B0\u1EE3c \u0111\u1EB7t trong segment ",(0,s.jsx)(e.code,{children:"api"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/pages/post-feed/api/get-posts.ts"',children:'import { apiClient } from "@/shared/api/base";\n\nimport { PostWithPaginationDto } from "./dto/post-with-pagination.dto";\nimport { PostQuery } from "./query/post.query";\nimport { mapPost } from "./mapper/map-post";\nimport { PostWithPagination } from "../model/post-with-pagination";\n\nconst calculatePostPage = (totalCount: number, limit: number) =>\n  Math.floor(totalCount / limit);\n\nexport const getPosts = async (\n  page: number,\n  limit: number,\n): Promise<PostWithPagination> => {\n  const skip = page * limit;\n  const query: PostQuery = { skip, limit };\n  const result = await apiClient.get<PostWithPaginationDto>("/posts", query);\n\n  return {\n    posts: result.posts.map((post) => mapPost(post)),\n    limit: result.limit,\n    skip: result.skip,\n    total: result.total,\n    totalPages: calculatePostPage(result.total, limit),\n  };\n};\n'})}),"\n",(0,s.jsx)(e.h3,{id:"2-query-factory-cho-ph\xe2n-trang",children:"2. Query factory cho ph\xe2n trang"}),"\n",(0,s.jsxs)(e.p,{children:["Query factory ",(0,s.jsx)(e.code,{children:"postQueries"})," \u0111\u1ECBnh ngh\u0129a c\xe1c query option kh\xe1c nhau \u0111\u1EC3 l\xe0m vi\u1EC7c v\u1EDBi post,\nbao g\u1ED3m request danh s\xe1ch post v\u1EDBi page v\xe0 limit c\u1EE5 th\u1EC3."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",children:'import { keepPreviousData, queryOptions } from "@tanstack/react-query";\nimport { getPosts } from "./get-posts";\n\nexport const postQueries = {\n  all: () => ["posts"],\n  lists: () => [...postQueries.all(), "list"],\n  list: (page: number, limit: number) =>\n    queryOptions({\n      queryKey: [...postQueries.lists(), page, limit],\n      queryFn: () => getPosts(page, limit),\n      placeholderData: keepPreviousData,\n    }),\n};\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3-s\u1EED-d\u1EE5ng-trong-code-\u1EE9ng-d\u1EE5ng",children:"3. S\u1EED d\u1EE5ng trong code \u1EE9ng d\u1EE5ng"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/pages/home/ui/index.tsx"',children:'export const HomePage = () => {\n  const itemsOnScreen = DEFAULT_ITEMS_ON_SCREEN;\n  const [page, setPage] = usePageParam(DEFAULT_PAGE);\n  const { data, isFetching, isLoading } = useQuery(\n    postApi.postQueries.list(page, itemsOnScreen),\n  );\n  return (\n    <>\n      <Pagination\n        onChange={(_, page) => setPage(page)}\n        page={page}\n        count={data?.totalPages}\n        variant="outlined"\n        color="primary"\n      />\n      <Posts posts={data?.posts} />\n    </>\n  );\n};\n'})}),"\n",(0,s.jsx)(e.admonition,{type:"note",children:(0,s.jsxs)(e.p,{children:["V\xed d\u1EE5 \u0111\xe3 \u0111\u01B0\u1EE3c \u0111\u01A1n gi\u1EA3n h\xf3a, phi\xean b\u1EA3n \u0111\u1EA7y \u0111\u1EE7 c\xf3 s\u1EB5n tr\xean ",(0,s.jsx)(e.a,{href:"https://github.com/ruslan4432013/fsd-react-query-example",children:"GitHub"})]})}),"\n",(0,s.jsxs)(e.h2,{id:"queryprovider-\u0111\u1EC3-qu\u1EA3n-l\xfd-queries",children:[(0,s.jsx)(e.code,{children:"QueryProvider"})," \u0111\u1EC3 qu\u1EA3n l\xfd queries"]}),"\n",(0,s.jsxs)(e.p,{children:["Trong h\u01B0\u1EDBng d\u1EABn n\xe0y, ch\xfang ta s\u1EBD xem c\xe1ch t\u1ED5 ch\u1EE9c m\u1ED9t ",(0,s.jsx)(e.code,{children:"QueryProvider"}),"."]}),"\n",(0,s.jsxs)(e.h3,{id:"1-t\u1EA1o-m\u1ED9t-queryprovider",children:["1. T\u1EA1o m\u1ED9t ",(0,s.jsx)(e.code,{children:"QueryProvider"})]}),"\n",(0,s.jsxs)(e.p,{children:["File ",(0,s.jsx)(e.code,{children:"query-provider.tsx"})," n\u1EB1m t\u1EA1i \u0111\u01B0\u1EDDng d\u1EABn ",(0,s.jsx)(e.code,{children:"@/app/providers/query-provider.tsx"}),"."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/app/providers/query-provider.tsx"',children:'import { QueryClient, QueryClientProvider } from "@tanstack/react-query";\nimport { ReactQueryDevtools } from "@tanstack/react-query-devtools";\nimport { ReactNode } from "react";\n\ntype Props = {\n  children: ReactNode;\n  client: QueryClient;\n};\n\nexport const QueryProvider = ({ client, children }: Props) => {\n  return (\n    <QueryClientProvider client={client}>\n      {children}\n      <ReactQueryDevtools />\n    </QueryClientProvider>\n  );\n};\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"2-t\u1EA1o-m\u1ED9t-queryclient",children:["2. T\u1EA1o m\u1ED9t ",(0,s.jsx)(e.code,{children:"QueryClient"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"QueryClient"})," l\xe0 m\u1ED9t instance \u0111\u01B0\u1EE3c s\u1EED d\u1EE5ng \u0111\u1EC3 qu\u1EA3n l\xfd c\xe1c API request.\nFile ",(0,s.jsx)(e.code,{children:"query-client.ts"})," n\u1EB1m t\u1EA1i ",(0,s.jsx)(e.code,{children:"@/shared/api/query-client.ts"}),".\n",(0,s.jsx)(e.code,{children:"QueryClient"})," \u0111\u01B0\u1EE3c t\u1EA1o v\u1EDBi c\xe1c c\xe0i \u0111\u1EB7t nh\u1EA5t \u0111\u1ECBnh cho vi\u1EC7c cache query."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/shared/api/query-client.ts"',children:'import { QueryClient } from "@tanstack/react-query";\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      staleTime: 5 * 60 * 1000,\n      gcTime: 5 * 60 * 1000,\n    },\n  },\n});\n'})}),"\n",(0,s.jsx)(e.h2,{id:"t\u1EF1-\u0111\u1ED9ng-sinh-code",children:"T\u1EF1 \u0111\u1ED9ng sinh code"}),"\n",(0,s.jsxs)(e.p,{children:["C\xf3 c\xe1c c\xf4ng c\u1EE5 c\xf3 th\u1EC3 t\u1EF1 \u0111\u1ED9ng sinh API code cho b\u1EA1n, nh\u01B0ng ch\xfang k\xe9m linh ho\u1EA1t h\u01A1n so v\u1EDBi c\xe1ch ti\u1EBFp c\u1EADn th\u1EE7 c\xf4ng \u0111\u01B0\u1EE3c m\xf4 t\u1EA3 \u1EDF tr\xean.\nN\u1EBFu file Swagger c\u1EE7a b\u1EA1n c\xf3 c\u1EA5u tr\xfac t\u1ED1t,\nv\xe0 b\u1EA1n \u0111ang s\u1EED d\u1EE5ng m\u1ED9t trong nh\u1EEFng c\xf4ng c\u1EE5 n\xe0y, vi\u1EC7c sinh t\u1EA5t c\u1EA3 code trong th\u01B0 m\u1EE5c ",(0,s.jsx)(e.code,{children:"@/shared/api"})," c\xf3 th\u1EC3 h\u1EE3p l\xfd."]}),"\n",(0,s.jsx)(e.h2,{id:"l\u1EDDi-khuy\xean-b\u1ED5-sung-cho-vi\u1EC7c-t\u1ED5-ch\u1EE9c-rq",children:"L\u1EDDi khuy\xean b\u1ED5 sung cho vi\u1EC7c t\u1ED5 ch\u1EE9c RQ"}),"\n",(0,s.jsx)(e.h3,{id:"api-client",children:"API Client"}),"\n",(0,s.jsx)(e.p,{children:"S\u1EED d\u1EE5ng m\u1ED9t class API client t\xf9y ch\u1EC9nh trong layer shared,\nb\u1EA1n c\xf3 th\u1EC3 chu\u1EA9n h\xf3a c\u1EA5u h\xecnh v\xe0 l\xe0m vi\u1EC7c v\u1EDBi API trong d\u1EF1 \xe1n.\n\u0110i\u1EC1u n\xe0y cho ph\xe9p b\u1EA1n qu\u1EA3n l\xfd logging,\nheader v\xe0 \u0111\u1ECBnh d\u1EA1ng trao \u0111\u1ED5i d\u1EEF li\u1EC7u (nh\u01B0 JSON ho\u1EB7c XML) t\u1EEB m\u1ED9t n\u01A1i.\nC\xe1ch ti\u1EBFp c\u1EADn n\xe0y gi\xfap d\u1EC5 d\xe0ng b\u1EA3o tr\xec v\xe0 ph\xe1t tri\u1EC3n d\u1EF1 \xe1n v\xec n\xf3 \u0111\u01A1n gi\u1EA3n h\xf3a c\xe1c thay \u0111\u1ED5i v\xe0 c\u1EADp nh\u1EADt t\u01B0\u01A1ng t\xe1c v\u1EDBi API."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-tsx",metastring:'title="@/shared/api/api-client.ts"',children:'import { API_URL } from "@/shared/config";\n\nexport class ApiClient {\n  private baseUrl: string;\n\n  constructor(url: string) {\n    this.baseUrl = url;\n  }\n\n  async handleResponse<TResult>(response: Response): Promise<TResult> {\n    if (!response.ok) {\n      throw new Error(`HTTP error! Status: ${response.status}`);\n    }\n\n    try {\n      return await response.json();\n    } catch (error) {\n      throw new Error("Error parsing JSON response");\n    }\n  }\n\n  public async get<TResult = unknown>(\n    endpoint: string,\n    queryParams?: Record<string, string | number>,\n  ): Promise<TResult> {\n    const url = new URL(endpoint, this.baseUrl);\n\n    if (queryParams) {\n      Object.entries(queryParams).forEach(([key, value]) => {\n        url.searchParams.append(key, value.toString());\n      });\n    }\n    const response = await fetch(url.toString(), {\n      method: "GET",\n      headers: {\n        "Content-Type": "application/json",\n      },\n    });\n\n    return this.handleResponse<TResult>(response);\n  }\n\n  public async post<TResult = unknown, TData = Record<string, unknown>>(\n    endpoint: string,\n    body: TData,\n  ): Promise<TResult> {\n    const response = await fetch(`${this.baseUrl}${endpoint}`, {\n      method: "POST",\n      headers: {\n        "Content-Type": "application/json",\n      },\n      body: JSON.stringify(body),\n    });\n\n    return this.handleResponse<TResult>(response);\n  }\n}\n\nexport const apiClient = new ApiClient(API_URL);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"see-also",children:"Xem th\xeam"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/ruslan4432013/fsd-react-query-example",children:"(GitHub) Project m\u1EABu"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://codesandbox.io/p/github/ruslan4432013/fsd-react-query-example/main",children:"(CodeSandbox) Project m\u1EABu"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://tkdodo.eu/blog/the-query-options-api",children:"V\u1EC1 query factory"})}),"\n"]})]})}function u(n={}){let{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},9447:function(n,e,t){t.d(e,{Z:()=>c,a:()=>o});var i=t(9546);let s={},r=i.createContext(s);function o(n){let e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);