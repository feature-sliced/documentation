"use strict";(self.webpackChunk_feature_sliced_documentation=self.webpackChunk_feature_sliced_documentation||[]).push([["8529"],{2635:function(n,e,t){t.r(e),t.d(e,{frontMatter:()=>o,default:()=>d,toc:()=>a,metadata:()=>i,assets:()=>s,contentTitle:()=>r});var i=JSON.parse('{"id":"guides/examples/auth","title":"Authentication","description":"N\xf3i chung, authentication bao g\u1ED3m c\xe1c b\u01B0\u1EDBc sau:","source":"@site/i18n/vi/docusaurus-plugin-content-docs/current/guides/examples/auth.md","sourceDirName":"guides/examples","slug":"/guides/examples/auth","permalink":"/documentation/vi/docs/guides/examples/auth","draft":false,"unlisted":false,"editUrl":"https://github.com/feature-sliced/documentation/edit/master/i18n/vi/docusaurus-plugin-content-docs/current/guides/examples/auth.md","tags":[],"version":"current","lastUpdatedAt":1757626519000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"FAQ","permalink":"/documentation/vi/docs/get-started/faq"},"next":{"title":"Types","permalink":"/documentation/vi/docs/guides/examples/types"}}'),c=t(4132),h=t(9447);let o={sidebar_position:1},r="Authentication",s={},a=[{value:"C\xe1ch l\u1EA5y credentials t\u1EEB ng\u01B0\u1EDDi d\xf9ng",id:"c\xe1ch-l\u1EA5y-credentials-t\u1EEB-ng\u01B0\u1EDDi-d\xf9ng",level:2},{value:"Page chuy\xean d\u1EE5ng cho login",id:"page-chuy\xean-d\u1EE5ng-cho-login",level:3},{value:"Dialog cho login",id:"dialog-cho-login",level:3},{value:"Client-side validation",id:"client-side-validation",level:3},{value:"C\xe1ch g\u1EEDi credentials \u0111\u1EBFn backend",id:"c\xe1ch-g\u1EEDi-credentials-\u0111\u1EBFn-backend",level:2},{value:"Two-factor authentication",id:"two-factor-authentication",level:3},{value:"C\xe1ch l\u01B0u tr\u1EEF token cho authenticated requests",id:"how-to-store-the-token-for-authenticated-requests",level:2},{value:"Trong Shared",id:"trong-shared",level:3},{value:"Trong Entities",id:"trong-entities",level:3},{value:"Trong Pages/Widgets (kh\xf4ng \u0111\u01B0\u1EE3c khuy\u1EBFn ngh\u1ECB)",id:"trong-pageswidgets-kh\xf4ng-\u0111\u01B0\u1EE3c-khuy\u1EBFn-ngh\u1ECB",level:3},{value:"Logout v\xe0 token invalidation",id:"logout-v\xe0-token-invalidation",level:2},{value:"Automatic logout",id:"automatic-logout",level:3}];function l(n){let e={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,h.a)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,c.jsx)(e.p,{children:"N\xf3i chung, authentication bao g\u1ED3m c\xe1c b\u01B0\u1EDBc sau:"}),"\n",(0,c.jsxs)(e.ol,{children:["\n",(0,c.jsx)(e.li,{children:"L\u1EA5y credentials t\u1EEB ng\u01B0\u1EDDi d\xf9ng"}),"\n",(0,c.jsx)(e.li,{children:"G\u1EEDi ch\xfang \u0111\u1EBFn backend"}),"\n",(0,c.jsx)(e.li,{children:"L\u01B0u tr\u1EEF token \u0111\u1EC3 th\u1EF1c hi\u1EC7n c\xe1c authenticated requests"}),"\n"]}),"\n",(0,c.jsx)(e.h2,{id:"c\xe1ch-l\u1EA5y-credentials-t\u1EEB-ng\u01B0\u1EDDi-d\xf9ng",children:"C\xe1ch l\u1EA5y credentials t\u1EEB ng\u01B0\u1EDDi d\xf9ng"}),"\n",(0,c.jsxs)(e.p,{children:["Ch\xfang t\xf4i gi\u1EA3 \u0111\u1ECBnh r\u1EB1ng app c\u1EE7a b\u1EA1n ch\u1ECBu tr\xe1ch nhi\u1EC7m l\u1EA5y credentials. N\u1EBFu b\u1EA1n c\xf3 authentication qua OAuth, b\u1EA1n c\xf3 th\u1EC3 \u0111\u01A1n gi\u1EA3n t\u1EA1o m\u1ED9t login page v\u1EDBi link \u0111\u1EBFn login page c\u1EE7a OAuth provider v\xe0 b\u1ECF qua \u0111\u1EBFn ",(0,c.jsx)(e.a,{href:"#how-to-store-the-token-for-authenticated-requests",children:"b\u01B0\u1EDBc 3"}),"."]}),"\n",(0,c.jsx)(e.h3,{id:"page-chuy\xean-d\u1EE5ng-cho-login",children:"Page chuy\xean d\u1EE5ng cho login"}),"\n",(0,c.jsx)(e.p,{children:"Th\xf4ng th\u01B0\u1EDDng, c\xe1c websites c\xf3 c\xe1c pages chuy\xean d\u1EE5ng cho login, n\u01A1i b\u1EA1n nh\u1EADp username v\xe0 password. C\xe1c pages n\xe0y kh\xe1 \u0111\u01A1n gi\u1EA3n, v\xec v\u1EADy ch\xfang kh\xf4ng y\xeau c\u1EA7u decomposition. Login v\xe0 registration forms kh\xe1 gi\u1ED1ng nhau v\u1EC1 ngo\u1EA1i h\xecnh, v\xec v\u1EADy ch\xfang th\u1EADm ch\xed c\xf3 th\u1EC3 \u0111\u01B0\u1EE3c nh\xf3m v\xe0o m\u1ED9t page. T\u1EA1o m\u1ED9t slice cho login/registration page c\u1EE7a b\u1EA1n tr\xean layer Pages:"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\uD83D\uDCC2 pages","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\uD83D\uDCC2 login","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\uD83D\uDCC2 ui","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\uD83D\uDCC4 LoginPage.tsx (or your framework's component file format)"}),"\n",(0,c.jsx)(e.li,{children:"\uD83D\uDCC4 RegisterPage.tsx"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.li,{children:"\uD83D\uDCC4 index.ts"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.li,{children:"other pages\u2026"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"\u1EDE \u0111\xe2y ch\xfang t\xf4i t\u1EA1o hai components v\xe0 export c\u1EA3 hai trong index file c\u1EE7a slice. C\xe1c components n\xe0y s\u1EBD ch\u1EE9a forms ch\u1ECBu tr\xe1ch nhi\u1EC7m tr\xecnh b\xe0y cho ng\u01B0\u1EDDi d\xf9ng c\xe1c controls d\u1EC5 hi\u1EC3u \u0111\u1EC3 l\u1EA5y credentials c\u1EE7a h\u1ECD."}),"\n",(0,c.jsx)(e.h3,{id:"dialog-cho-login",children:"Dialog cho login"}),"\n",(0,c.jsx)(e.p,{children:"N\u1EBFu app c\u1EE7a b\u1EA1n c\xf3 dialog cho login c\xf3 th\u1EC3 \u0111\u01B0\u1EE3c s\u1EED d\u1EE5ng tr\xean b\u1EA5t k\u1EF3 page n\xe0o, h\xe3y c\xe2n nh\u1EAFc t\u1EA1o dialog \u0111\xf3 th\xe0nh m\u1ED9t widget. B\u1EB1ng c\xe1ch \u0111\xf3, b\u1EA1n v\u1EABn c\xf3 th\u1EC3 tr\xe1nh qu\xe1 nhi\u1EC1u decomposition, nh\u01B0ng c\xf3 t\u1EF1 do t\xe1i s\u1EED d\u1EE5ng dialog n\xe0y tr\xean b\u1EA5t k\u1EF3 page n\xe0o."}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\uD83D\uDCC2 widgets","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\uD83D\uDCC2 login-dialog","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["\uD83D\uDCC2 ui","\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"\uD83D\uDCC4 LoginDialog.tsx"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.li,{children:"\uD83D\uDCC4 index.ts"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.li,{children:"other widgets\u2026"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"Ph\u1EA7n c\xf2n l\u1EA1i c\u1EE7a h\u01B0\u1EDBng d\u1EABn n\xe0y \u0111\u01B0\u1EE3c vi\u1EBFt cho c\xe1ch ti\u1EBFp c\u1EADn dedicated page, nh\u01B0ng c\xe1c nguy\xean t\u1EAFc t\u01B0\u01A1ng t\u1EF1 \xe1p d\u1EE5ng cho dialog widget."}),"\n",(0,c.jsx)(e.h3,{id:"client-side-validation",children:"Client-side validation"}),"\n",(0,c.jsxs)(e.p,{children:["Thi\u1EC7ng tho\u1EA3ng, \u0111\u1EB7c bi\u1EC7t l\xe0 cho registration, vi\u1EC7c th\u1EF1c hi\u1EC7n client-side validation \u0111\u1EC3 cho ng\u01B0\u1EDDi d\xf9ng bi\u1EBFt nhanh ch\xf3ng r\u1EB1ng h\u1ECD \u0111\xe3 m\u1EAFc l\u1ED7i l\xe0 h\u1EE3p l\xfd. Validation c\xf3 th\u1EC3 di\u1EC5n ra trong segment ",(0,c.jsx)(e.code,{children:"model"})," c\u1EE7a login page. S\u1EED d\u1EE5ng m\u1ED9t schema validation library, v\xed d\u1EE5, ",(0,c.jsx)(e.a,{href:"https://zod.dev",children:"Zod"})," cho JS/TS, v\xe0 expose schema \u0111\xf3 cho segment ",(0,c.jsx)(e.code,{children:"ui"}),":"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-ts",metastring:'title="pages/login/model/registration-schema.ts"',children:'import { z } from "zod";\n\nexport const registrationData = z.object({\n    email: z.string().email(),\n    password: z.string().min(6),\n    confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n    message: "Passwords do not match",\n    path: ["confirmPassword"],\n});\n'})}),"\n",(0,c.jsxs)(e.p,{children:["Sau \u0111\xf3, trong segment ",(0,c.jsx)(e.code,{children:"ui"}),", b\u1EA1n c\xf3 th\u1EC3 s\u1EED d\u1EE5ng schema n\xe0y \u0111\u1EC3 validate user input:"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-tsx",metastring:'title="pages/login/ui/RegisterPage.tsx"',children:'import { registrationData } from "../model/registration-schema";\n\nfunction validate(formData: FormData) {\n    const data = Object.fromEntries(formData.entries());\n    try {\n        registrationData.parse(data);\n    } catch (error) {\n        // TODO: Show error message to the user\n    }\n}\n\nexport function RegisterPage() {\n    return (\n        <form onSubmit={(e) => validate(new FormData(e.target))}>\n            <label htmlFor="email">E-mail</label>\n            <input id="email" name="email" required />\n\n            <label htmlFor="password">Password (min. 6 characters)</label>\n            <input id="password" name="password" type="password" required />\n\n            <label htmlFor="confirmPassword">Confirm password</label>\n            <input id="confirmPassword" name="confirmPassword" type="password" required />\n        </form>\n    )\n}\n'})}),"\n",(0,c.jsx)(e.h2,{id:"c\xe1ch-g\u1EEDi-credentials-\u0111\u1EBFn-backend",children:"C\xe1ch g\u1EEDi credentials \u0111\u1EBFn backend"}),"\n",(0,c.jsxs)(e.p,{children:["T\u1EA1o m\u1ED9t function th\u1EF1c hi\u1EC7n request \u0111\u1EBFn login endpoint c\u1EE7a backend. Function n\xe0y c\xf3 th\u1EC3 \u0111\u01B0\u1EE3c g\u1ECDi tr\u1EF1c ti\u1EBFp trong component code s\u1EED d\u1EE5ng mutation library (v\xed d\u1EE5 TanStack Query), ho\u1EB7c c\xf3 th\u1EC3 \u0111\u01B0\u1EE3c g\u1ECDi nh\u01B0 side effect trong state manager. Nh\u01B0 \u0111\u01B0\u1EE3c gi\u1EA3i th\xedch trong ",(0,c.jsx)(e.a,{href:"/docs/guides/examples/api-requests",children:"h\u01B0\u1EDBng d\u1EABn cho API requests"}),", b\u1EA1n c\xf3 th\u1EC3 \u0111\u1EB7t request c\u1EE7a m\xecnh trong ",(0,c.jsx)(e.code,{children:"shared/api"})," ho\u1EB7c trong segment ",(0,c.jsx)(e.code,{children:"api"})," c\u1EE7a login page."]}),"\n",(0,c.jsx)(e.h3,{id:"two-factor-authentication",children:"Two-factor authentication"}),"\n",(0,c.jsxs)(e.p,{children:["N\u1EBFu app c\u1EE7a b\u1EA1n h\u1ED7 tr\u1EE3 two-factor authentication (2FA), b\u1EA1n c\xf3 th\u1EC3 ph\u1EA3i redirect \u0111\u1EBFn page kh\xe1c n\u01A1i ng\u01B0\u1EDDi d\xf9ng c\xf3 th\u1EC3 nh\u1EADp one-time password. Th\xf4ng th\u01B0\u1EDDng ",(0,c.jsx)(e.code,{children:"POST /login"})," request c\u1EE7a b\u1EA1n s\u1EBD tr\u1EA3 v\u1EC1 user object v\u1EDBi flag ch\u1EC9 ra r\u1EB1ng ng\u01B0\u1EDDi d\xf9ng \u0111\xe3 b\u1EADt 2FA. N\u1EBFu flag \u0111\xf3 \u0111\u01B0\u1EE3c thi\u1EBFt l\u1EADp, redirect ng\u01B0\u1EDDi d\xf9ng \u0111\u1EBFn 2FA page."]}),"\n",(0,c.jsxs)(e.p,{children:["V\xec page n\xe0y li\xean quan r\u1EA5t ch\u1EB7t ch\u1EBD \u0111\u1EBFn logging in, b\u1EA1n c\u0169ng c\xf3 th\u1EC3 gi\u1EEF n\xf3 trong c\xf9ng m\u1ED9t slice, ",(0,c.jsx)(e.code,{children:"login"})," tr\xean layer Pages."]}),"\n",(0,c.jsxs)(e.p,{children:["B\u1EA1n c\u0169ng c\u1EA7n m\u1ED9t request function kh\xe1c, t\u01B0\u01A1ng t\u1EF1 nh\u01B0 ",(0,c.jsx)(e.code,{children:"login()"})," m\xe0 ch\xfang t\xf4i \u0111\xe3 t\u1EA1o \u1EDF tr\xean. \u0110\u1EB7t ch\xfang c\xf9ng nhau, ho\u1EB7c trong Shared, ho\u1EB7c trong segment ",(0,c.jsx)(e.code,{children:"api"})," c\u1EE7a page ",(0,c.jsx)(e.code,{children:"login"}),"."]}),"\n",(0,c.jsx)(e.h2,{id:"how-to-store-the-token-for-authenticated-requests",children:"C\xe1ch l\u01B0u tr\u1EEF token cho authenticated requests"}),"\n",(0,c.jsx)(e.p,{children:"B\u1EA5t k\u1EC3 authentication scheme n\xe0o b\u1EA1n c\xf3, cho d\xf9 l\xe0 login & password \u0111\u01A1n gi\u1EA3n, OAuth, ho\u1EB7c two-factor authentication, cu\u1ED1i c\xf9ng b\u1EA1n s\u1EBD nh\u1EADn \u0111\u01B0\u1EE3c m\u1ED9t token. Token n\xe0y n\xean \u0111\u01B0\u1EE3c l\u01B0u tr\u1EEF \u0111\u1EC3 c\xe1c requests ti\u1EBFp theo c\xf3 th\u1EC3 identify ch\xednh ch\xfang."}),"\n",(0,c.jsxs)(e.p,{children:["L\u01B0u tr\u1EEF token l\xfd t\u01B0\u1EDFng cho web app l\xe0 ",(0,c.jsx)(e.strong,{children:"cookie"})," \u2014 n\xf3 kh\xf4ng y\xeau c\u1EA7u token storage ho\u1EB7c handling th\u1EE7 c\xf4ng. V\xec v\u1EADy, cookie storage h\u1EA7u nh\u01B0 kh\xf4ng c\u1EA7n c\xe2n nh\u1EAFc g\xec t\u1EEB ph\xeda frontend architecture. N\u1EBFu frontend framework c\u1EE7a b\u1EA1n c\xf3 server side (v\xed d\u1EE5, ",(0,c.jsx)(e.a,{href:"https://remix.run",children:"Remix"}),"), th\xec b\u1EA1n n\xean l\u01B0u tr\u1EEF server-side cookie infrastructure trong ",(0,c.jsx)(e.code,{children:"shared/api"}),". C\xf3 m\u1ED9t v\xed d\u1EE5 trong ",(0,c.jsx)(e.a,{href:"/docs/get-started/tutorial#authentication",children:"ph\u1EA7n Authentication c\u1EE7a tutorial"})," v\u1EC1 c\xe1ch th\u1EF1c hi\u1EC7n \u0111i\u1EC1u \u0111\xf3 v\u1EDBi Remix."]}),"\n",(0,c.jsx)(e.p,{children:"Tuy nhi\xean, \u0111\xf4i khi cookie storage kh\xf4ng ph\u1EA3i l\xe0 l\u1EF1a ch\u1ECDn. Trong tr\u01B0\u1EDDng h\u1EE3p n\xe0y, b\u1EA1n s\u1EBD ph\u1EA3i l\u01B0u tr\u1EEF token th\u1EE7 c\xf4ng. Ngo\xe0i vi\u1EC7c l\u01B0u tr\u1EEF token, b\u1EA1n c\u0169ng c\xf3 th\u1EC3 c\u1EA7n thi\u1EBFt l\u1EADp logic \u0111\u1EC3 refresh token khi n\xf3 expires. V\u1EDBi FSD, c\xf3 nhi\u1EC1u n\u01A1i b\u1EA1n c\xf3 th\u1EC3 l\u01B0u tr\u1EEF token, c\u0169ng nh\u01B0 nhi\u1EC1u c\xe1ch \u0111\u1EC3 l\xe0m cho n\xf3 available cho ph\u1EA7n c\xf2n l\u1EA1i c\u1EE7a app."}),"\n",(0,c.jsx)(e.h3,{id:"trong-shared",children:"Trong Shared"}),"\n",(0,c.jsxs)(e.p,{children:["C\xe1ch ti\u1EBFp c\u1EADn n\xe0y ho\u1EA1t \u0111\u1ED9ng t\u1ED1t v\u1EDBi API client \u0111\u01B0\u1EE3c define trong ",(0,c.jsx)(e.code,{children:"shared/api"})," v\xec token c\xf3 s\u1EB5n m\u1ED9t c\xe1ch t\u1EF1 do cho c\xe1c request functions kh\xe1c y\xeau c\u1EA7u authentication \u0111\u1EC3 th\xe0nh c\xf4ng. B\u1EA1n c\xf3 th\u1EC3 l\xe0m cho API client gi\u1EEF state, ho\u1EB7c v\u1EDBi reactive store ho\u1EB7c \u0111\u01A1n gi\u1EA3n l\xe0 module-level variable, v\xe0 c\u1EADp nh\u1EADt state \u0111\xf3 trong c\xe1c functions ",(0,c.jsx)(e.code,{children:"login()"}),"/",(0,c.jsx)(e.code,{children:"logout()"})," c\u1EE7a b\u1EA1n."]}),"\n",(0,c.jsx)(e.p,{children:"Automatic token refresh c\xf3 th\u1EC3 \u0111\u01B0\u1EE3c implement nh\u01B0 middleware trong API client \u2014 th\u1EE9 g\xec \u0111\xf3 c\xf3 th\u1EC3 th\u1EF1c thi m\u1ED7i khi b\u1EA1n th\u1EF1c hi\u1EC7n b\u1EA5t k\u1EF3 request n\xe0o. N\xf3 c\xf3 th\u1EC3 ho\u1EA1t \u0111\u1ED9ng nh\u01B0 th\u1EBF n\xe0y:"}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"Authenticate v\xe0 l\u01B0u tr\u1EEF access token c\u0169ng nh\u01B0 refresh token"}),"\n",(0,c.jsx)(e.li,{children:"Th\u1EF1c hi\u1EC7n b\u1EA5t k\u1EF3 request n\xe0o y\xeau c\u1EA7u authentication"}),"\n",(0,c.jsx)(e.li,{children:"N\u1EBFu request th\u1EA5t b\u1EA1i v\u1EDBi status code ch\u1EC9 ra token expiration, v\xe0 c\xf3 token trong store, th\u1EF1c hi\u1EC7n refresh request, l\u01B0u tr\u1EEF c\xe1c tokens m\u1EDBi, v\xe0 retry request g\u1ED1c"}),"\n"]}),"\n",(0,c.jsxs)(e.p,{children:["M\u1ED9t trong nh\u1EEFng drawbacks c\u1EE7a c\xe1ch ti\u1EBFp c\u1EADn n\xe0y l\xe0 logic managing v\xe0 refreshing token kh\xf4ng c\xf3 m\u1ED9t n\u01A1i chuy\xean d\u1EE5ng. \u0110i\u1EC1u n\xe0y c\xf3 th\u1EC3 \u1ED5n \u0111\u1ED1i v\u1EDBi m\u1ED9t s\u1ED1 apps ho\u1EB7c teams, nh\u01B0ng n\u1EBFu logic token management ph\u1EE9c t\u1EA1p h\u01A1n, c\xf3 th\u1EC3 t\u1ED1t h\u01A1n l\xe0 t\xe1ch bi\u1EC7t tr\xe1ch nhi\u1EC7m c\u1EE7a vi\u1EC7c th\u1EF1c hi\u1EC7n requests v\xe0 managing tokens. B\u1EA1n c\xf3 th\u1EC3 l\xe0m \u0111i\u1EC1u \u0111\xf3 b\u1EB1ng c\xe1ch gi\u1EEF requests v\xe0 API client trong ",(0,c.jsx)(e.code,{children:"shared/api"}),", nh\u01B0ng token store v\xe0 management logic trong ",(0,c.jsx)(e.code,{children:"shared/auth"}),"."]}),"\n",(0,c.jsxs)(e.p,{children:["M\u1ED9t drawback kh\xe1c c\u1EE7a c\xe1ch ti\u1EBFp c\u1EADn n\xe0y l\xe0 n\u1EBFu backend c\u1EE7a b\u1EA1n tr\u1EA3 v\u1EC1 object th\xf4ng tin c\u1EE7a current user c\xf9ng v\u1EDBi token, b\u1EA1n ph\u1EA3i l\u01B0u tr\u1EEF \u0111i\u1EC1u \u0111\xf3 \u1EDF \u0111\xe2u \u0111\xf3 ho\u1EB7c b\u1ECF qua th\xf4ng tin \u0111\xf3 v\xe0 request l\u1EA1i t\u1EEB endpoint nh\u01B0 ",(0,c.jsx)(e.code,{children:"/me"})," ho\u1EB7c ",(0,c.jsx)(e.code,{children:"/users/current"}),"."]}),"\n",(0,c.jsx)(e.h3,{id:"trong-entities",children:"Trong Entities"}),"\n",(0,c.jsx)(e.p,{children:"Th\xf4ng th\u01B0\u1EDDng c\xe1c d\u1EF1 \xe1n FSD c\xf3 m\u1ED9t entity cho user v\xe0/ho\u1EB7c m\u1ED9t entity cho current user. N\xf3 th\u1EADm ch\xed c\xf3 th\u1EC3 l\xe0 c\xf9ng m\u1ED9t entity cho c\u1EA3 hai."}),"\n",(0,c.jsx)(e.admonition,{type:"note",children:(0,c.jsxs)(e.p,{children:[(0,c.jsx)(e.strong,{children:"Current user"}),' \u0111\xf4i khi c\u0169ng \u0111\u01B0\u1EE3c g\u1ECDi l\xe0 "viewer" ho\u1EB7c "me". \u0110i\u1EC1u n\xe0y l\xe0 \u0111\u1EC3 ph\xe2n bi\u1EC7t single authenticated user, v\u1EDBi permissions v\xe0 private information, t\u1EEB danh s\xe1ch t\u1EA5t c\u1EA3 users v\u1EDBi publicly accessible information.']})}),"\n",(0,c.jsxs)(e.p,{children:["\u0110\u1EC3 l\u01B0u tr\u1EEF token trong User entity, t\u1EA1o reactive store trong segment ",(0,c.jsx)(e.code,{children:"model"}),". Store \u0111\xf3 c\xf3 th\u1EC3 ch\u1EE9a c\u1EA3 token v\xe0 user object."]}),"\n",(0,c.jsxs)(e.p,{children:["V\xec API client th\u01B0\u1EDDng \u0111\u01B0\u1EE3c define trong ",(0,c.jsx)(e.code,{children:"shared/api"})," ho\u1EB7c spread qua c\xe1c entities, th\xe1ch th\u1EE9c ch\xednh c\u1EE7a c\xe1ch ti\u1EBFp c\u1EADn n\xe0y l\xe0 l\xe0m cho token available cho c\xe1c requests kh\xe1c c\u1EA7n n\xf3 m\xe0 kh\xf4ng vi ph\u1EA1m ",(0,c.jsx)(e.a,{href:"/docs/reference/layers#import-rule-on-layers",children:"import rule tr\xean c\xe1c layers"}),":"]}),"\n",(0,c.jsxs)(e.blockquote,{children:["\n",(0,c.jsx)(e.p,{children:"M\u1ED9t module (file) trong slice ch\u1EC9 c\xf3 th\u1EC3 import c\xe1c slices kh\xe1c khi ch\xfang \u0111\u01B0\u1EE3c \u0111\u1EB7t tr\xean c\xe1c layers \u1EDF ph\xeda d\u01B0\u1EDBi."}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:"C\xf3 nhi\u1EC1u gi\u1EA3i ph\xe1p cho th\xe1ch th\u1EE9c n\xe0y:"}),"\n",(0,c.jsxs)(e.ol,{children:["\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.strong,{children:"Pass token th\u1EE7 c\xf4ng m\u1ED7i l\u1EA7n b\u1EA1n th\u1EF1c hi\u1EC7n request"}),(0,c.jsx)(e.br,{}),"\n","\u0110\xe2y l\xe0 gi\u1EA3i ph\xe1p \u0111\u01A1n gi\u1EA3n nh\u1EA5t, nh\u01B0ng n\xf3 nhanh ch\xf3ng tr\u1EDF n\xean c\u1ED3ng k\u1EC1nh, v\xe0 n\u1EBFu b\u1EA1n kh\xf4ng c\xf3 type safety, d\u1EC5 qu\xean. N\xf3 c\u0169ng kh\xf4ng t\u01B0\u01A1ng th\xedch v\u1EDBi middlewares pattern cho API client trong Shared."]}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsxs)(e.strong,{children:["Expose token cho to\xe0n b\u1ED9 app v\u1EDBi context ho\u1EB7c global store nh\u01B0 ",(0,c.jsx)(e.code,{children:"localStorage"})]}),(0,c.jsx)(e.br,{}),"\n","Key \u0111\u1EC3 retrieve token s\u1EBD \u0111\u01B0\u1EE3c gi\u1EEF trong ",(0,c.jsx)(e.code,{children:"shared/api"})," \u0111\u1EC3 API client c\xf3 th\u1EC3 truy c\u1EADp n\xf3. Reactive store c\u1EE7a token s\u1EBD \u0111\u01B0\u1EE3c export t\u1EEB User entity, v\xe0 context provider (n\u1EBFu c\u1EA7n) s\u1EBD \u0111\u01B0\u1EE3c thi\u1EBFt l\u1EADp tr\xean layer App. \u0110i\u1EC1u n\xe0y cho nhi\u1EC1u t\u1EF1 do h\u01A1n \u0111\u1EC3 thi\u1EBFt k\u1EBF API client, tuy nhi\xean, n\xf3 t\u1EA1o ra implicit dependency tr\xean c\xe1c layers cao h\u01A1n \u0111\u1EC3 cung c\u1EA5p context. Khi theo c\xe1ch ti\u1EBFp c\u1EADn n\xe0y, h\xe3y c\xe2n nh\u1EAFc cung c\u1EA5p c\xe1c error messages h\u1EEFu \xedch n\u1EBFu context ho\u1EB7c ",(0,c.jsx)(e.code,{children:"localStorage"})," kh\xf4ng \u0111\u01B0\u1EE3c thi\u1EBFt l\u1EADp ch\xednh x\xe1c."]}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.strong,{children:"Inject token v\xe0o API client m\u1ED7i khi n\xf3 thay \u0111\u1ED5i"}),(0,c.jsx)(e.br,{}),"\n",'N\u1EBFu store c\u1EE7a b\u1EA1n l\xe0 reactive, b\u1EA1n c\xf3 th\u1EC3 t\u1EA1o subscription s\u1EBD c\u1EADp nh\u1EADt token store c\u1EE7a API client m\u1ED7i khi store trong entity thay \u0111\u1ED5i. \u0110i\u1EC1u n\xe0y t\u01B0\u01A1ng t\u1EF1 nh\u01B0 gi\u1EA3i ph\xe1p tr\u01B0\u1EDBc \u1EDF ch\u1ED7 ch\xfang \u0111\u1EC1u t\u1EA1o implicit dependency tr\xean c\xe1c layers cao h\u01A1n, nh\u01B0ng c\xe1i n\xe0y imperative h\u01A1n ("push"), trong khi c\xe1i tr\u01B0\u1EDBc declarative h\u01A1n ("pull").']}),"\n"]}),"\n",(0,c.jsxs)(e.p,{children:["Khi b\u1EA1n v\u01B0\u1EE3t qua th\xe1ch th\u1EE9c expose token \u0111\u01B0\u1EE3c l\u01B0u tr\u1EEF trong model c\u1EE7a entity, b\u1EA1n c\xf3 th\u1EC3 encode nhi\u1EC1u business logic li\xean quan \u0111\u1EBFn token management. V\xed d\u1EE5, segment ",(0,c.jsx)(e.code,{children:"model"})," c\xf3 th\u1EC3 ch\u1EE9a logic \u0111\u1EC3 invalidate token sau m\u1ED9t kho\u1EA3ng th\u1EDDi gian nh\u1EA5t \u0111\u1ECBnh, ho\u1EB7c refresh token khi n\xf3 expires. \u0110\u1EC3 th\u1EF1c s\u1EF1 th\u1EF1c hi\u1EC7n requests \u0111\u1EBFn backend, s\u1EED d\u1EE5ng segment ",(0,c.jsx)(e.code,{children:"api"})," c\u1EE7a User entity ho\u1EB7c ",(0,c.jsx)(e.code,{children:"shared/api"}),"."]}),"\n",(0,c.jsx)(e.h3,{id:"trong-pageswidgets-kh\xf4ng-\u0111\u01B0\u1EE3c-khuy\u1EBFn-ngh\u1ECB",children:"Trong Pages/Widgets (kh\xf4ng \u0111\u01B0\u1EE3c khuy\u1EBFn ngh\u1ECB)"}),"\n",(0,c.jsxs)(e.p,{children:["Kh\xf4ng \u0111\u01B0\u1EE3c khuy\u1EBFn kh\xedch l\u01B0u tr\u1EEF app-wide state nh\u01B0 access token trong pages ho\u1EB7c widgets. Tr\xe1nh \u0111\u1EB7t token store c\u1EE7a b\u1EA1n trong segment ",(0,c.jsx)(e.code,{children:"model"})," c\u1EE7a login page, thay v\xe0o \u0111\xf3 h\xe3y ch\u1ECDn t\u1EEB hai gi\u1EA3i ph\xe1p \u0111\u1EA7u ti\xean, Shared ho\u1EB7c Entities."]}),"\n",(0,c.jsx)(e.h2,{id:"logout-v\xe0-token-invalidation",children:"Logout v\xe0 token invalidation"}),"\n",(0,c.jsx)(e.p,{children:"Th\xf4ng th\u01B0\u1EDDng, c\xe1c apps kh\xf4ng c\xf3 m\u1ED9t page ho\xe0n ch\u1EC9nh cho logging out, nh\u01B0ng logout functionality v\u1EABn r\u1EA5t quan tr\u1ECDng. N\xf3 bao g\u1ED3m authenticated request \u0111\u1EBFn backend v\xe0 c\u1EADp nh\u1EADt token store."}),"\n",(0,c.jsxs)(e.p,{children:["N\u1EBFu b\u1EA1n l\u01B0u tr\u1EEF t\u1EA5t c\u1EA3 requests trong ",(0,c.jsx)(e.code,{children:"shared/api"}),", h\xe3y gi\u1EEF logout request function \u1EDF \u0111\xf3, g\u1EA7n login function. N\u1EBFu kh\xf4ng, h\xe3y c\xe2n nh\u1EAFc gi\u1EEF logout request function g\u1EA7n button k\xedch ho\u1EA1t n\xf3. V\xed d\u1EE5, n\u1EBFu b\u1EA1n c\xf3 header widget xu\u1EA5t hi\u1EC7n tr\xean m\u1ED7i page v\xe0 ch\u1EE9a logout link, h\xe3y \u0111\u1EB7t request \u0111\xf3 trong segment ",(0,c.jsx)(e.code,{children:"api"})," c\u1EE7a widget \u0111\xf3."]}),"\n",(0,c.jsxs)(e.p,{children:["C\u1EADp nh\u1EADt token store s\u1EBD ph\u1EA3i \u0111\u01B0\u1EE3c trigger t\u1EEB v\u1ECB tr\xed c\u1EE7a logout button, nh\u01B0 header widget. B\u1EA1n c\xf3 th\u1EC3 k\u1EBFt h\u1EE3p request v\xe0 store update trong segment ",(0,c.jsx)(e.code,{children:"model"})," c\u1EE7a widget \u0111\xf3."]}),"\n",(0,c.jsx)(e.h3,{id:"automatic-logout",children:"Automatic logout"}),"\n",(0,c.jsxs)(e.p,{children:["\u0110\u1EEBng qu\xean x\xe2y d\u1EF1ng c\xe1c failsafes cho khi request log out th\u1EA5t b\u1EA1i, ho\u1EB7c request refresh login token th\u1EA5t b\u1EA1i. Trong c\u1EA3 hai tr\u01B0\u1EDDng h\u1EE3p n\xe0y, b\u1EA1n n\xean clear token store. N\u1EBFu b\u1EA1n gi\u1EEF token trong Entities, code n\xe0y c\xf3 th\u1EC3 \u0111\u01B0\u1EE3c \u0111\u1EB7t trong segment ",(0,c.jsx)(e.code,{children:"model"})," v\xec n\xf3 l\xe0 pure business logic. N\u1EBFu b\u1EA1n gi\u1EEF token trong Shared, \u0111\u1EB7t logic n\xe0y trong ",(0,c.jsx)(e.code,{children:"shared/api"})," c\xf3 th\u1EC3 l\xe0m segment ph\xecnh to v\xe0 pha lo\xe3ng m\u1EE5c \u0111\xedch c\u1EE7a n\xf3. N\u1EBFu b\u1EA1n nh\u1EADn th\u1EA5y r\u1EB1ng API segment c\u1EE7a m\xecnh ch\u1EE9a nhi\u1EC1u th\u1EE9 kh\xf4ng li\xean quan, h\xe3y c\xe2n nh\u1EAFc t\xe1ch logic token management th\xe0nh segment kh\xe1c, v\xed d\u1EE5, ",(0,c.jsx)(e.code,{children:"shared/auth"}),"."]})]})}function d(n={}){let{wrapper:e}={...(0,h.a)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(l,{...n})}):l(n)}},9447:function(n,e,t){t.d(e,{Z:()=>r,a:()=>o});var i=t(9546);let c={},h=i.createContext(c);function o(n){let e=i.useContext(h);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:o(n.components),i.createElement(h.Provider,{value:e},n.children)}}}]);