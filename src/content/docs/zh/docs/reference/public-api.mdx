---
title: Public API
sidebar:
  order: 3
---

import { FileTree, Aside } from '@astrojs/starlight/components';

Public API æ˜¯ä¸€ç»„æ¨¡å—ï¼ˆå¦‚ sliceï¼‰ä¸ä½¿ç”¨å®ƒçš„ä»£ç ä¹‹é—´çš„_å¥‘çº¦_ã€‚å®ƒä¹Ÿå……å½“ç½‘å…³ï¼Œåªå…è®¸è®¿é—®æŸäº›å¯¹è±¡ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡è¯¥ public API è®¿é—®ã€‚

åœ¨å®è·µä¸­ï¼Œå®ƒé€šå¸¸ä½œä¸ºå…·æœ‰é‡æ–°å¯¼å‡ºçš„ index æ–‡ä»¶å®ç°ï¼š

```js title="pages/auth/index.js"
export { LoginPage } from "./ui/LoginPage";
export { RegisterPage } from "./ui/RegisterPage";
```

## ä»€ä¹ˆæ„æˆäº†å¥½çš„ public APIï¼Ÿ

å¥½çš„ public API ä½¿å¾—ä½¿ç”¨å’Œé›†æˆåˆ°å…¶ä»–ä»£ç ä¸­çš„ slice æ–¹ä¾¿å¯é ã€‚è¿™å¯ä»¥é€šè¿‡è®¾å®šè¿™ä¸‰ä¸ªç›®æ ‡æ¥å®ç°ï¼š

1. åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¿…é¡»å—åˆ°ä¿æŠ¤ï¼Œå…å— slice ç»“æ„å˜åŒ–ï¼ˆå¦‚é‡æ„ï¼‰çš„å½±å“
1. slice è¡Œä¸ºçš„é‡å¤§å˜åŒ–ï¼ˆç ´åäº†ä¹‹å‰çš„æœŸæœ›ï¼‰åº”è¯¥å¯¼è‡´ public API çš„å˜åŒ–
1. åªåº”è¯¥æš´éœ² slice çš„å¿…è¦éƒ¨åˆ†

æœ€åä¸€ä¸ªç›®æ ‡æœ‰ä¸€äº›é‡è¦çš„å®é™…å«ä¹‰ã€‚åˆ›å»ºæ‰€æœ‰å†…å®¹çš„é€šé…ç¬¦é‡æ–°å¯¼å‡ºå¯èƒ½å¾ˆè¯±äººï¼Œç‰¹åˆ«æ˜¯åœ¨ slice çš„æ—©æœŸå¼€å‘ä¸­ï¼Œå› ä¸ºæ‚¨ä»æ–‡ä»¶ä¸­å¯¼å‡ºçš„ä»»ä½•æ–°å¯¹è±¡ä¹Ÿä¼šè‡ªåŠ¨ä» slice å¯¼å‡ºï¼š

```js title="Bad practice, features/comments/index.js"
// âŒ BAD CODE BELOW, DON'T DO THIS
export * from "./ui/Comment";  // ğŸ‘ don't try this at home
export * from "./model/comments";  // ğŸ’© this is bad practice
```

è¿™ä¼šæŸå®³ slice çš„å¯å‘ç°æ€§ï¼Œå› ä¸ºæ‚¨æ— æ³•è½»æ˜“åœ°è¯´å‡ºè¿™ä¸ª slice çš„æ¥å£æ˜¯ä»€ä¹ˆã€‚ä¸çŸ¥é“æ¥å£æ„å‘³ç€æ‚¨å¿…é¡»æ·±å…¥æŒ–æ˜ slice çš„ä»£ç æ‰èƒ½ç†è§£å¦‚ä½•é›†æˆå®ƒã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯æ‚¨å¯èƒ½æ„å¤–åœ°æš´éœ²æ¨¡å—å†…éƒ¨ï¼Œå¦‚æœæœ‰äººå¼€å§‹ä¾èµ–å®ƒä»¬ï¼Œè¿™å°†ä½¿é‡æ„å˜å¾—å›°éš¾ã€‚

## ç”¨äºäº¤å‰å¯¼å…¥çš„ Public API \{#public-api-for-cross-imports}

äº¤å‰å¯¼å…¥æ˜¯æŒ‡åŒä¸€ layer ä¸Šçš„ä¸€ä¸ª slice ä»å¦ä¸€ä¸ª slice å¯¼å…¥çš„æƒ…å†µã€‚é€šå¸¸è¿™è¢« [layers ä¸Šçš„å¯¼å…¥è§„åˆ™][import-rule-on-layers] ç¦æ­¢ï¼Œä½†ç»å¸¸æœ‰åˆç†çš„äº¤å‰å¯¼å…¥ç†ç”±ã€‚ä¾‹å¦‚ï¼Œä¸šåŠ¡ entities åœ¨ç°å®ä¸–ç•Œä¸­ç»å¸¸ç›¸äº’å¼•ç”¨ï¼Œæœ€å¥½åœ¨ä»£ç ä¸­åæ˜ è¿™äº›å…³ç³»è€Œä¸æ˜¯ç»•è¿‡å®ƒä»¬ã€‚

ä¸ºæ­¤ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šçš„ public APIï¼Œä¹Ÿç§°ä¸º `@x` è®°å·æ³•ã€‚å¦‚æœæ‚¨æœ‰ entities A å’Œ Bï¼Œå¹¶ä¸” entity B éœ€è¦ä» entity A å¯¼å…¥ï¼Œé‚£ä¹ˆ entity A å¯ä»¥ä¸º entity B å£°æ˜ä¸€ä¸ªå•ç‹¬çš„ public APIã€‚

<FileTree>
- entities
  - A
    - @x
      - B.ts ä»…ç”¨äº `entities/B/` å†…éƒ¨ä»£ç çš„ç‰¹æ®Š public API
    - index.ts å¸¸è§„ public API
</FileTree>

ç„¶å `entities/B/` å†…éƒ¨çš„ä»£ç å¯ä»¥ä» `entities/A/@x/B` å¯¼å…¥ï¼š

```ts
import type { EntityA } from "entities/A/@x/B";
```

è®°å·æ³• `A/@x/B` æ—¨åœ¨è¯»ä½œ "A crossed with B"ã€‚

<Aside>

å°½é‡å‡å°‘äº¤å‰å¯¼å…¥ï¼Œå¹¶ä¸”**ä»…åœ¨ Entities layer ä¸Šä½¿ç”¨æ­¤è®°å·æ³•**ï¼Œåœ¨è¯¥ layer ä¸Šæ¶ˆé™¤äº¤å‰å¯¼å…¥é€šå¸¸æ˜¯ä¸åˆç†çš„ã€‚

</Aside>

## index æ–‡ä»¶çš„é—®é¢˜

åƒ `index.js` è¿™æ ·çš„ index æ–‡ä»¶ï¼ˆä¹Ÿç§°ä¸º barrel æ–‡ä»¶ï¼‰æ˜¯å®šä¹‰ public API çš„æœ€å¸¸è§æ–¹å¼ã€‚å®ƒä»¬å®¹æ˜“åˆ¶ä½œï¼Œä½†ä¼—æ‰€å‘¨çŸ¥ä¼šåœ¨æŸäº›æ‰“åŒ…å™¨å’Œæ¡†æ¶ä¸­å¼•èµ·é—®é¢˜ã€‚

### å¾ªç¯å¯¼å…¥

å¾ªç¯å¯¼å…¥æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ç›¸äº’å¯¼å…¥ã€‚

<figure>
    <img src="../../../../../../static/img/circular-import-light.svg" data-theme-only="light" width="60%" alt="Three files importing each other in a circle" />
    <img src="../../../../../../static/img/circular-import-dark.svg" data-theme-only="dark" width="60%" alt="Three files importing each other in a circle" />
    <figcaption>
        Pictured above: three files, `fileA.js`, `fileB.js`, and `fileC.js`, importing each other in a circle.
    </figcaption>
</figure>

è¿™äº›æƒ…å†µå¯¹äºæ‰“åŒ…å™¨æ¥è¯´é€šå¸¸éš¾ä»¥å¤„ç†ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬ç”šè‡³å¯èƒ½å¯¼è‡´éš¾ä»¥è°ƒè¯•çš„è¿è¡Œæ—¶é”™è¯¯ã€‚

å¾ªç¯å¯¼å…¥å¯ä»¥åœ¨æ²¡æœ‰ index æ–‡ä»¶çš„æƒ…å†µä¸‹å‘ç”Ÿï¼Œä½†æ‹¥æœ‰ index æ–‡ä»¶æä¾›äº†æ„å¤–åˆ›å»ºå¾ªç¯å¯¼å…¥çš„æ˜æ˜¾æœºä¼šã€‚å½“æ‚¨åœ¨ slice çš„ public API ä¸­æœ‰ä¸¤ä¸ªæš´éœ²çš„å¯¹è±¡æ—¶ï¼Œè¿™ç»å¸¸å‘ç”Ÿï¼Œä¾‹å¦‚ `HomePage` å’Œ `loadUserStatistics`ï¼Œå¹¶ä¸” `HomePage` éœ€è¦è®¿é—® `loadUserStatistics`ï¼Œä½†å®ƒåƒè¿™æ ·åšï¼š

```jsx title="pages/home/ui/HomePage.jsx"
import { loadUserStatistics } from "../"; // importing from pages/home/index.js

export function HomePage() { /* â€¦ */ }
```

```js title="pages/home/index.js"
export { HomePage } from "./ui/HomePage";
export { loadUserStatistics } from "./api/loadUserStatistics";
```

è¿™ç§æƒ…å†µåˆ›å»ºäº†å¾ªç¯å¯¼å…¥ï¼Œå› ä¸º `index.js` å¯¼å…¥ `ui/HomePage.jsx`ï¼Œä½† `ui/HomePage.jsx` å¯¼å…¥ `index.js`ã€‚

ä¸ºäº†é˜²æ­¢è¿™ä¸ªé—®é¢˜ï¼Œè€ƒè™‘è¿™ä¸¤ä¸ªåŸåˆ™ã€‚å¦‚æœæ‚¨æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªä»å¦ä¸€ä¸ªå¯¼å…¥ï¼š
- å½“å®ƒä»¬åœ¨åŒä¸€ä¸ª slice ä¸­æ—¶ï¼Œå§‹ç»ˆä½¿ç”¨_ç›¸å¯¹_å¯¼å…¥å¹¶ç¼–å†™å®Œæ•´çš„å¯¼å…¥è·¯å¾„
- å½“å®ƒä»¬åœ¨ä¸åŒçš„ slices ä¸­æ—¶ï¼Œå§‹ç»ˆä½¿ç”¨_ç»å¯¹_å¯¼å…¥ï¼Œä¾‹å¦‚ä½¿ç”¨åˆ«å

### Shared ä¸­çš„å¤§å‹åŒ…å’ŒæŸåçš„ tree-shaking \{#large-bundles}

å½“æ‚¨æœ‰ä¸€ä¸ªé‡æ–°å¯¼å‡ºæ‰€æœ‰å†…å®¹çš„ index æ–‡ä»¶æ—¶ï¼ŒæŸäº›æ‰“åŒ…å™¨å¯èƒ½åœ¨ tree-shakingï¼ˆç§»é™¤æœªå¯¼å…¥çš„ä»£ç ï¼‰æ–¹é¢é‡åˆ°å›°éš¾ã€‚

é€šå¸¸è¿™å¯¹äº public APIs æ¥è¯´ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºæ¨¡å—çš„å†…å®¹é€šå¸¸å…³ç³»éå¸¸å¯†åˆ‡ï¼Œæ‰€ä»¥æ‚¨å¾ˆå°‘éœ€è¦å¯¼å…¥ä¸€ä¸ªä¸œè¥¿å¹¶ tree-shake æ‰å¦ä¸€ä¸ªã€‚ç„¶è€Œï¼Œå½“ FSD ä¸­çš„æ­£å¸¸ public API è§„åˆ™å¯èƒ½å¯¼è‡´é—®é¢˜æ—¶ï¼Œæœ‰ä¸¤ä¸ªéå¸¸å¸¸è§çš„æƒ…å†µ â€” `shared/ui` å’Œ `shared/lib`ã€‚

è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹éƒ½æ˜¯ä¸ç›¸å…³äº‹ç‰©çš„é›†åˆï¼Œé€šå¸¸ä¸æ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹éƒ½éœ€è¦çš„ã€‚ä¾‹å¦‚ï¼Œ`shared/ui` å¯èƒ½ä¸º UI åº“ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰æ¨¡å—ï¼š

<FileTree>
- shared/
  - ui/
    - button/
    - text-field/
    - carousel/
    - accordion/
</FileTree>

å½“å…¶ä¸­ä¸€ä¸ªæ¨¡å—æœ‰é‡åº¦ä¾èµ–æ—¶ï¼Œè¿™ä¸ªé—®é¢˜ä¼šå˜å¾—æ›´åŠ ä¸¥é‡ï¼Œæ¯”å¦‚è¯­æ³•çªå‡ºæ˜¾ç¤ºå™¨æˆ–æ‹–æ”¾åº“ã€‚æ‚¨ä¸å¸Œæœ›å°†è¿™äº›å¼•å…¥åˆ°ä½¿ç”¨ `shared/ui` ä¸­æŸäº›å†…å®¹çš„æ¯ä¸ªé¡µé¢ä¸­ï¼Œä¾‹å¦‚æŒ‰é’®ã€‚

å¦‚æœæ‚¨çš„åŒ…ç”±äº `shared/ui` æˆ– `shared/lib` ä¸­çš„å•ä¸ª public API è€Œä¸å¿…è¦åœ°å¢é•¿ï¼Œå»ºè®®æ”¹ä¸ºä¸ºæ¯ä¸ªç»„ä»¶æˆ–åº“å•ç‹¬æœ‰ä¸€ä¸ª index æ–‡ä»¶ï¼š

<FileTree>
- shared/
  - ui/
    - button/
      - index.js
    - text-field/
      - index.js
</FileTree>

ç„¶åè¿™äº›ç»„ä»¶çš„ä½¿ç”¨è€…å¯ä»¥åƒè¿™æ ·ç›´æ¥å¯¼å…¥å®ƒä»¬ï¼š

```js title="pages/sign-in/ui/SignInPage.jsx"
import { Button } from '@/shared/ui/button';
import { TextField } from '@/shared/ui/text-field';
```

### å¯¹ç»è¿‡ public API æ²¡æœ‰çœŸæ­£çš„ä¿æŠ¤

å½“æ‚¨ä¸º slice åˆ›å»º index æ–‡ä»¶æ—¶ï¼Œæ‚¨å®é™…ä¸Šå¹¶æ²¡æœ‰ç¦æ­¢ä»»ä½•äººä¸ä½¿ç”¨å®ƒè€Œç›´æ¥å¯¼å…¥ã€‚è¿™å¯¹äºè‡ªåŠ¨å¯¼å…¥æ¥è¯´å°¤å…¶æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæœ‰å‡ ä¸ªä½ç½®å¯ä»¥å¯¼å…¥å¯¹è±¡ï¼Œæ‰€ä»¥ IDE å¿…é¡»ä¸ºæ‚¨åšå†³å®šã€‚æœ‰æ—¶å®ƒå¯èƒ½é€‰æ‹©ç›´æ¥å¯¼å…¥ï¼Œç ´å slices ä¸Šçš„ public API è§„åˆ™ã€‚

ä¸ºäº†è‡ªåŠ¨æ•è·è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ [Steiger][ext-steiger]ï¼Œä¸€ä¸ªå…·æœ‰ Feature-Sliced Design è§„åˆ™é›†çš„æ¶æ„ linterã€‚

### å¤§å‹é¡¹ç›®ä¸­æ‰“åŒ…å™¨çš„è¾ƒå·®æ€§èƒ½

åœ¨é¡¹ç›®ä¸­å…·æœ‰å¤§é‡ index æ–‡ä»¶å¯èƒ½ä¼šå‡æ…¢å¼€å‘æœåŠ¡å™¨ï¼Œæ­£å¦‚ TkDodo åœ¨[ä»–çš„æ–‡ç« â€œè¯·åœæ­¢ä½¿ç”¨ Barrel æ–‡ä»¶â€][ext-please-stop-using-barrel-files]ä¸­æ‰€æŒ‡å‡ºçš„ã€‚

æ‚¨å¯ä»¥åšå‡ ä»¶äº‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š
1. ä¸[â€œShared ä¸­çš„å¤§å‹åŒ…å’ŒæŸåçš„ tree-shakingâ€é—®é¢˜](#large-bundles)ç›¸åŒçš„å»ºè®® â€” åœ¨ `shared/ui` å’Œ `shared/lib` ä¸­ä¸ºæ¯ä¸ªç»„ä»¶/åº“å•ç‹¬æœ‰ index æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¤§çš„
2. é¿å…åœ¨æœ‰ slices çš„ layers ä¸Šçš„ segments ä¸­æœ‰ index æ–‡ä»¶ã€‚  
   ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªç”¨äº feature â€œcommentsâ€ çš„ indexï¼Œ`ğŸ“„ features/comments/index.js`ï¼Œåˆ™æ²¡æœ‰ç†ç”±ä¸ºè¯¥ feature çš„ `ui` segment æœ‰å¦ä¸€ä¸ª indexï¼Œ`ğŸ“„ features/comments/ui/index.js`ã€‚
3. å¦‚æœæ‚¨æœ‰ä¸€ä¸ªéå¸¸å¤§çš„é¡¹ç›®ï¼Œå¾ˆå¯èƒ½æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ†å‰²æˆå‡ ä¸ªå¤§å—ã€‚  
   ä¾‹å¦‚ï¼ŒGoogle Docs åœ¨æ–‡æ¡£ç¼–è¾‘å™¨å’Œæ–‡ä»¶æµè§ˆå™¨æ–¹é¢æœ‰éå¸¸ä¸åŒçš„è´£ä»»ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª monorepo è®¾ç½®ï¼Œå…¶ä¸­æ¯ä¸ªåŒ…éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ FSD æ ¹ï¼Œå…·æœ‰è‡ªå·±çš„ layers é›†ã€‚æŸäº›åŒ…å¯èƒ½åªæœ‰ Shared å’Œ Entities layersï¼Œå…¶ä»–åŒ…å¯èƒ½åªæœ‰ Pages å’Œ Appï¼Œè¿˜æœ‰ä¸€äº›åŒ…å¯èƒ½åŒ…å«å®ƒä»¬è‡ªå·±çš„å° Sharedï¼Œä½†ä»ç„¶ä½¿ç”¨å¦ä¸€ä¸ªåŒ…ä¸­çš„å¤§ Sharedã€‚

[import-rule-on-layers]: /docs/reference/layers#import-rule-on-layers
[ext-steiger]: https://github.com/feature-sliced/steiger
[ext-please-stop-using-barrel-files]: https://tkdodo.eu/blog/please-stop-using-barrel-files
