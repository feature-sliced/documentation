---
title: Types
sidebar:
  order: 2
---

import { FileTree, Aside } from '@astrojs/starlight/components';

HÆ°á»›ng dáº«n nÃ y liÃªn quan Ä‘áº¿n data types tá»« cÃ¡c typed languages nhÆ° TypeScript vÃ  mÃ´ táº£ chÃºng phÃ¹ há»£p á»Ÿ Ä‘Ã¢u trong FSD.

<Aside>

CÃ¢u há»i cá»§a báº¡n khÃ´ng Ä‘Æ°á»£c Ä‘á» cáº­p trong hÆ°á»›ng dáº«n nÃ y? ÄÄƒng cÃ¢u há»i cá»§a báº¡n báº±ng cÃ¡ch Ä‘á»ƒ láº¡i feedback trÃªn bÃ i viáº¿t nÃ y (nÃºt xanh á»Ÿ bÃªn pháº£i) vÃ  chÃºng tÃ´i sáº½ cÃ¢n nháº¯c má»Ÿ rá»™ng hÆ°á»›ng dáº«n nÃ y!

</Aside>

## Utility types

Utility types lÃ  cÃ¡c types khÃ´ng cÃ³ nhiá»u Ã½ nghÄ©a riÃªng vÃ  thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i cÃ¡c types khÃ¡c. VÃ­ dá»¥:

<figure>

```ts
type ArrayValues<T extends readonly unknown[]> = T[number];
```

<figcaption>
  Nguá»“n: https://github.com/sindresorhus/type-fest/blob/main/source/array-values.d.ts
</figcaption>

</figure>

Äá»ƒ lÃ m cho utility types cÃ³ sáºµn trong toÃ n bá»™ dá»± Ã¡n cá»§a báº¡n, hoáº·c lÃ  install má»™t library nhÆ° [`type-fest`][ext-type-fest], hoáº·c táº¡o library riÃªng cá»§a báº¡n trong `shared/lib`. Äáº£m báº£o chá»‰ rÃµ rÃ ng nhá»¯ng types má»›i nÃ o _nÃªn_ Ä‘Æ°á»£c thÃªm vÃ o library nÃ y, vÃ  nhá»¯ng types nÃ o _khÃ´ng thuá»™c vá»_ Ä‘Ã³. VÃ­ dá»¥, gá»i nÃ³ lÃ  `shared/lib/utility-types` vÃ  thÃªm README bÃªn trong mÃ´ táº£ utility type lÃ  gÃ¬ trong team cá»§a báº¡n.

Äá»«ng Ä‘Ã¡nh giÃ¡ quÃ¡ cao kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng cá»§a utility type. Chá»‰ vÃ¬ nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¡i sá»­ dá»¥ng, khÃ´ng cÃ³ nghÄ©a lÃ  nÃ³ sáº½ Ä‘Æ°á»£c tÃ¡i sá»­ dá»¥ng, vÃ  vÃ¬ váº­y, khÃ´ng pháº£i má»i utility type Ä‘á»u cáº§n á»Ÿ trong Shared. Má»™t sá»‘ utility types thÃ¬ á»•n ngay bÃªn cáº¡nh nÆ¡i chÃºng Ä‘Æ°á»£c cáº§n:
      
<FileTree>
- pages/
  - home/
    - api/
      - ArrayValues.ts utility type
      - getMemoryUsageMetrics.ts code sá»­ dá»¥ng utility type
</FileTree>

<Aside type="caution">

HÃ£y cÆ°á»¡ng láº¡i cÃ¡m dá»— táº¡o folder `shared/types`, hoáº·c thÃªm segment `types` vÃ o slices cá»§a báº¡n. Category "types" tÆ°Æ¡ng tá»± nhÆ° category "components" hoáº·c "hooks" á»Ÿ chá»— nÃ³ mÃ´ táº£ ná»™i dung lÃ  gÃ¬, chá»© khÃ´ng pháº£i chÃºng dÃ nh cho gÃ¬. Segments nÃªn mÃ´ táº£ má»¥c Ä‘Ã­ch cá»§a code, khÃ´ng pháº£i báº£n cháº¥t.

</Aside>

## Business entities vÃ  cross-references cá»§a chÃºng

Trong sá»‘ nhá»¯ng types quan trá»ng nháº¥t trong app lÃ  types cá»§a business entities, tá»©c lÃ  nhá»¯ng thá»© trong tháº¿ giá»›i thá»±c mÃ  app cá»§a báº¡n lÃ m viá»‡c vá»›i. VÃ­ dá»¥, trong music streaming app, báº¡n cÃ³ thá»ƒ cÃ³ business entities _Song_, _Album_, v.v.

Business entities thÆ°á»ng Ä‘áº¿n tá»« backend, vÃ¬ váº­y bÆ°á»›c Ä‘áº§u tiÃªn lÃ  type backend responses. Tháº­t tiá»‡n lá»£i khi cÃ³ function Ä‘á»ƒ thá»±c hiá»‡n request Ä‘áº¿n má»—i endpoint, vÃ  type response cá»§a function nÃ y. Äá»ƒ cÃ³ thÃªm type safety, báº¡n cÃ³ thá»ƒ muá»‘n cháº¡y response qua schema validation library nhÆ° [Zod][ext-zod]. 

VÃ­ dá»¥, náº¿u báº¡n giá»¯ táº¥t cáº£ requests cá»§a mÃ¬nh trong Shared, báº¡n cÃ³ thá»ƒ lÃ m nhÆ° tháº¿ nÃ y:

```ts title="shared/api/songs.ts"
import type { Artist } from "./artists";

interface Song {
  id: number;
  title: string;
  artists: Array<Artist>;
}

export function listSongs() {
  return fetch('/api/songs').then((res) => res.json() as Promise<Array<Song>>);
}
```

Báº¡n cÃ³ thá»ƒ nháº­n tháº¥y ráº±ng type `Song` tham chiáº¿u Ä‘áº¿n má»™t entity khÃ¡c, `Artist`. ÄÃ¢y lÃ  lá»£i Ã­ch cá»§a viá»‡c lÆ°u trá»¯ requests cá»§a báº¡n trong Shared â€” cÃ¡c types tháº¿ giá»›i thá»±c thÆ°á»ng Ä‘an xen. Náº¿u chÃºng ta giá»¯ function nÃ y trong `entities/song/api`, chÃºng ta sáº½ khÃ´ng thá»ƒ Ä‘Æ¡n giáº£n import `Artist` tá»« `entities/artist`, vÃ¬ FSD háº¡n cháº¿ cross-imports giá»¯a cÃ¡c slices vá»›i [import rule trÃªn cÃ¡c layers][import-rule-on-layers]:

> Má»™t module trong slice chá»‰ cÃ³ thá»ƒ import cÃ¡c slices khÃ¡c khi chÃºng Ä‘Æ°á»£c Ä‘áº·t trÃªn cÃ¡c layers á»Ÿ phÃ­a dÆ°á»›i.

CÃ³ hai cÃ¡ch Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y:

1. **Tham sá»‘ hÃ³a cÃ¡c types cá»§a báº¡n**  
   Báº¡n cÃ³ thá»ƒ lÃ m cho types cá»§a mÃ¬nh cháº¥p nháº­n type arguments lÃ m slots cho cÃ¡c káº¿t ná»‘i vá»›i entities khÃ¡c, vÃ  tháº­m chÃ­ Ã¡p dá»¥ng constraints trÃªn nhá»¯ng slots Ä‘Ã³. VÃ­ dá»¥:

   ```ts title="entities/song/model/song.ts"
   interface Song<ArtistType extends { id: string }> {
     id: number;
     title: string;
     artists: Array<ArtistType>;
   }
   ```

   Äiá»u nÃ y hoáº¡t Ä‘á»™ng tá»‘t hÆ¡n cho má»™t sá»‘ types so vá»›i nhá»¯ng types khÃ¡c. Má»™t type Ä‘Æ¡n giáº£n nhÆ° `Cart = { items: Array<Product> }` cÃ³ thá»ƒ dá»… dÃ ng Ä‘Æ°á»£c lÃ m Ä‘á»ƒ hoáº¡t Ä‘á»™ng vá»›i báº¥t ká»³ loáº¡i product nÃ o. CÃ¡c types káº¿t ná»‘i nhiá»u hÆ¡n, nhÆ° `Country` vÃ  `City`, cÃ³ thá»ƒ khÃ´ng dá»… tÃ¡ch rá»i.

2. **Cross-import (nhÆ°ng lÃ m Ä‘Ãºng cÃ¡ch)**  
   Äá»ƒ thá»±c hiá»‡n cross-imports giá»¯a cÃ¡c entities trong FSD, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng public API Ä‘áº·c biá»‡t dÃ nh riÃªng cho má»—i slice sáº½ cross-importing. VÃ­ dá»¥, náº¿u chÃºng ta cÃ³ entities `song`, `artist`, vÃ  `playlist`, vÃ  hai cÃ¡i sau cáº§n tham chiáº¿u `song`, chÃºng ta cÃ³ thá»ƒ táº¡o hai public APIs Ä‘áº·c biá»‡t cho cáº£ hai trong entity `song` vá»›i kÃ½ hiá»‡u `@x`:

   <FileTree>
   - entities/
     - song/
       - @x/
         - artist.ts public API cho entity `artist` Ä‘á»ƒ import
         - playlist.ts public API cho entity `playlist` Ä‘á»ƒ import
       - index.ts public API thÃ´ng thÆ°á»ng
   </FileTree>
   
   Ná»™i dung cá»§a file `ğŸ“„ entities/song/@x/artist.ts` tÆ°Æ¡ng tá»± nhÆ° `ğŸ“„ entities/song/index.ts`:

   ```ts title="entities/song/@x/artist.ts"
   export type { Song } from "../model/song.ts";
   ```

   Sau Ä‘Ã³ `ğŸ“„ entities/artist/model/artist.ts` cÃ³ thá»ƒ import `Song` nhÆ° tháº¿ nÃ y:

   ```ts title="entities/artist/model/artist.ts"
   import type { Song } from "entities/song/@x/artist";

   export interface Artist {
     name: string;
     songs: Array<Song>;
   }
   ```

   Báº±ng cÃ¡ch táº¡o káº¿t ná»‘i rÃµ rÃ ng giá»¯a cÃ¡c entities, chÃºng ta kiá»ƒm soÃ¡t Ä‘Æ°á»£c inter-dependencies vÃ  duy trÃ¬ má»©c Ä‘á»™ phÃ¢n tÃ¡ch domain tá»‘t.

## Data transfer objects vÃ  mappers \{#data-transfer-objects-and-mappers}

Data transfer objects, hay DTOs, lÃ  thuáº­t ngá»¯ mÃ´ táº£ hÃ¬nh dáº¡ng cá»§a dá»¯ liá»‡u Ä‘áº¿n tá»« backend. ÄÃ´i khi, DTO cÃ³ thá»ƒ sá»­ dá»¥ng ngay, nhÆ°ng Ä‘Ã´i khi nÃ³ khÃ´ng thuáº­n tiá»‡n cho frontend. ÄÃ³ lÃ  lÃºc mappers xuáº¥t hiá»‡n â€” chÃºng biáº¿n Ä‘á»•i DTO thÃ nh hÃ¬nh dáº¡ng thuáº­n tiá»‡n hÆ¡n.

### Äáº·t DTOs á»Ÿ Ä‘Ã¢u

Náº¿u báº¡n cÃ³ backend types trong package riÃªng (vÃ­ dá»¥, náº¿u báº¡n chia sáº» code giá»¯a frontend vÃ  backend), thÃ¬ chá»‰ cáº§n import DTOs tá»« Ä‘Ã³ vÃ  xong! Náº¿u báº¡n khÃ´ng chia sáº» code giá»¯a backend vÃ  frontend, thÃ¬ báº¡n cáº§n giá»¯ DTOs á»Ÿ Ä‘Ã¢u Ä‘Ã³ trong frontend codebase, vÃ  chÃºng ta sáº½ khÃ¡m phÃ¡ trÆ°á»ng há»£p nÃ y dÆ°á»›i Ä‘Ã¢y.

Náº¿u báº¡n cÃ³ request functions trong `shared/api`, Ä‘Ã³ lÃ  nÆ¡i DTOs nÃªn á»Ÿ, ngay cáº¡nh function sá»­ dá»¥ng chÃºng:

```ts title="shared/api/songs.ts"
import type { ArtistDTO } from "./artists";

interface SongDTO {
  id: number;
  title: string;
  artist_ids: Array<ArtistDTO["id"]>;
}

export function listSongs() {
  return fetch('/api/songs').then((res) => res.json() as Promise<Array<SongDTO>>);
}
```

NhÆ° Ä‘Ã£ Ä‘á» cáº­p trong pháº§n trÆ°á»›c, lÆ°u trá»¯ requests vÃ  DTOs cá»§a báº¡n trong Shared mang láº¡i lá»£i Ã­ch cÃ³ thá»ƒ tham chiáº¿u DTOs khÃ¡c.

### Äáº·t mappers á»Ÿ Ä‘Ã¢u

Mappers lÃ  cÃ¡c functions cháº¥p nháº­n DTO Ä‘á»ƒ biáº¿n Ä‘á»•i, vÃ  vÃ¬ váº­y, chÃºng nÃªn Ä‘Æ°á»£c Ä‘áº·t gáº§n Ä‘á»‹nh nghÄ©a cá»§a DTO. Trong thá»±c táº¿ Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  náº¿u requests vÃ  DTOs cá»§a báº¡n Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `shared/api`, thÃ¬ mappers cÅ©ng nÃªn á»Ÿ Ä‘Ã³:

```ts title="shared/api/songs.ts"
import type { ArtistDTO } from "./artists";

interface SongDTO {
  id: number;
  title: string;
  disc_no: number;
  artist_ids: Array<ArtistDTO["id"]>;
}

interface Song {
  id: string;
  title: string;
  /** TiÃªu Ä‘á» Ä‘áº§y Ä‘á»§ cá»§a bÃ i hÃ¡t, bao gá»“m sá»‘ Ä‘Ä©a. */
  fullTitle: string;
  artistIds: Array<string>;
}

function adaptSongDTO(dto: SongDTO): Song {
  return {
    id: String(dto.id),
    title: dto.title,
    fullTitle: `${dto.disc_no} / ${dto.title}`,
    artistIds: dto.artist_ids.map(String),
  };
}

export function listSongs() {
  return fetch('/api/songs').then(async (res) => (await res.json()).map(adaptSongDTO));
}
```

Náº¿u requests vÃ  stores cá»§a báº¡n Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong entity slices, thÃ¬ táº¥t cáº£ code nÃ y sáº½ Ä‘i vÃ o Ä‘Ã³, nhá»› lÆ°u Ã½ giá»›i háº¡n cá»§a cross-imports giá»¯a cÃ¡c slices:

```ts title="entities/song/api/dto.ts"
import type { ArtistDTO } from "entities/artist/@x/song";

export interface SongDTO {
  id: number;
  title: string;
  disc_no: number;
  artist_ids: Array<ArtistDTO["id"]>;
}
```

```ts title="entities/song/api/mapper.ts"
import type { SongDTO } from "./dto";

export interface Song {
  id: string;
  title: string;
  /** TiÃªu Ä‘á» Ä‘áº§y Ä‘á»§ cá»§a bÃ i hÃ¡t, bao gá»“m sá»‘ Ä‘Ä©a. */
  fullTitle: string;
  artistIds: Array<string>;
}

export function adaptSongDTO(dto: SongDTO): Song {
  return {
    id: String(dto.id),
    title: dto.title,
    fullTitle: `${dto.disc_no} / ${dto.title}`,
    artistIds: dto.artist_ids.map(String),
  };
}
```

```ts title="entities/song/api/listSongs.ts"
import { adaptSongDTO } from "./mapper";

export function listSongs() {
  return fetch('/api/songs').then(async (res) => (await res.json()).map(adaptSongDTO));
}
```

```ts title="entities/song/model/songs.ts"
import { createSlice, createEntityAdapter } from "@reduxjs/toolkit";

import { listSongs } from "../api/listSongs";

export const fetchSongs = createAsyncThunk('songs/fetchSongs', listSongs);

const songAdapter = createEntityAdapter();
const songsSlice = createSlice({
  name: "songs",
  initialState: songAdapter.getInitialState(),
  reducers: {},
  extraReducers: (builder) => {
    builder.addCase(fetchSongs.fulfilled, (state, action) => {
      songAdapter.upsertMany(state, action.payload);
    })
  },
});
```

### CÃ¡ch xá»­ lÃ½ nested DTOs

Pháº§n cÃ³ váº¥n Ä‘á» nháº¥t lÃ  khi response tá»« backend chá»©a nhiá»u entities. VÃ­ dá»¥, náº¿u bÃ i hÃ¡t bao gá»“m khÃ´ng chá»‰ IDs cá»§a tÃ¡c giáº£, mÃ  cáº£ toÃ n bá»™ author objects. Trong trÆ°á»ng há»£p nÃ y, khÃ´ng thá»ƒ cho cÃ¡c entities khÃ´ng biáº¿t vá» nhau (trá»« khi chÃºng ta muá»‘n loáº¡i bá» dá»¯ liá»‡u hoáº·c cÃ³ cuá»™c trÃ² chuyá»‡n nghiÃªm tÃºc vá»›i backend team). Thay vÃ¬ nghÄ© ra giáº£i phÃ¡p cho káº¿t ná»‘i giÃ¡n tiáº¿p giá»¯a cÃ¡c slices (nhÆ° common middleware sáº½ dispatch actions Ä‘áº¿n slices khÃ¡c), Æ°u tiÃªn cross-imports rÃµ rÃ ng vá»›i kÃ½ hiá»‡u `@x`. ÄÃ¢y lÃ  cÃ¡ch chÃºng ta cÃ³ thá»ƒ triá»ƒn khai vá»›i Redux Toolkit:

```ts title="entities/song/model/songs.ts"
import {
  createSlice,
  createEntityAdapter,
  createAsyncThunk,
  createSelector,
} from '@reduxjs/toolkit'
import { normalize, schema } from 'normalizr'

import { getSong } from "../api/getSong";

// Äá»‹nh nghÄ©a normalizr entity schemas
export const artistEntity = new schema.Entity('artists')
export const songEntity = new schema.Entity('songs', {
  artists: [artistEntity],
})

const songAdapter = createEntityAdapter()

export const fetchSong = createAsyncThunk(
  'songs/fetchSong',
  async (id: string) => {
    const data = await getSong(id)
    // Normalize dá»¯ liá»‡u Ä‘á»ƒ reducers cÃ³ thá»ƒ load payload dá»± Ä‘oÃ¡n Ä‘Æ°á»£c, nhÆ°:
    // `action.payload = { songs: {}, artists: {} }`
    const normalized = normalize(data, songEntity)
    return normalized.entities
  }
)

export const slice = createSlice({
  name: 'songs',
  initialState: songAdapter.getInitialState(),
  reducers: {},
  extraReducers: (builder) => {
    builder.addCase(fetchSong.fulfilled, (state, action) => {
      songAdapter.upsertMany(state, action.payload.songs)
    })
  },
})

const reducer = slice.reducer
export default reducer
```

```ts title="entities/song/@x/artist.ts"
export { fetchSong } from "../model/songs";
```

```ts title="entities/artist/model/artists.ts"
import { createSlice, createEntityAdapter } from '@reduxjs/toolkit'

import { fetchSong } from 'entities/song/@x/artist'

const artistAdapter = createEntityAdapter()

export const slice = createSlice({
  name: 'users',
  initialState: artistAdapter.getInitialState(),
  reducers: {},
  extraReducers: (builder) => {
    builder.addCase(fetchSong.fulfilled, (state, action) => {
      // VÃ  xá»­ lÃ½ cÃ¹ng fetch result báº±ng cÃ¡ch chÃ¨n artists á»Ÿ Ä‘Ã¢y
      artistAdapter.upsertMany(state, action.payload.artists)
    })
  },
})

const reducer = slice.reducer
export default reducer
```

Äiá»u nÃ y háº¡n cháº¿ má»™t chÃºt lá»£i Ã­ch cá»§a slice isolation, nhÆ°ng nÃ³ thá»ƒ hiá»‡n chÃ­nh xÃ¡c káº¿t ná»‘i giá»¯a hai entities nÃ y mÃ  chÃºng ta khÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c. Náº¿u cÃ¡c entities nÃ y cáº§n Ä‘Æ°á»£c refactor, chÃºng pháº£i Ä‘Æ°á»£c refactor cÃ¹ng nhau.

## Global types vÃ  Redux

Global types lÃ  types sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng trong toÃ n bá»™ á»©ng dá»¥ng. CÃ³ hai loáº¡i global types, dá»±a trÃªn nhá»¯ng gÃ¬ chÃºng cáº§n biáº¿t:
1. Generic types khÃ´ng cÃ³ báº¥t ká»³ Ä‘áº·c Ä‘iá»ƒm á»©ng dá»¥ng nÃ o
2. Types cáº§n biáº¿t vá» toÃ n bá»™ á»©ng dá»¥ng

TrÆ°á»ng há»£p Ä‘áº§u tiÃªn Ä‘Æ¡n giáº£n Ä‘á»ƒ giáº£i quyáº¿t â€” Ä‘áº·t types cá»§a báº¡n trong Shared, trong segment phÃ¹ há»£p. VÃ­ dá»¥, náº¿u báº¡n cÃ³ interface cho global variable cho analytics, báº¡n cÃ³ thá»ƒ Ä‘áº·t nÃ³ trong `shared/analytics`.

<Aside type="caution">

TrÃ¡nh táº¡o folder `shared/types`. NÃ³ nhÃ³m nhá»¯ng thá»© khÃ´ng liÃªn quan chá»‰ dá»±a trÃªn thuá»™c tÃ­nh "lÃ  má»™t type", vÃ  thuá»™c tÃ­nh Ä‘Ã³ thÆ°á»ng khÃ´ng há»¯u Ã­ch khi tÃ¬m kiáº¿m code trong dá»± Ã¡n.

</Aside>

TrÆ°á»ng há»£p thá»© hai thÆ°á»ng gáº·p trong cÃ¡c dá»± Ã¡n vá»›i Redux khÃ´ng cÃ³ RTK. Store type cuá»‘i cÃ¹ng cá»§a báº¡n chá»‰ cÃ³ sáºµn khi báº¡n thÃªm táº¥t cáº£ reducers láº¡i vá»›i nhau, nhÆ°ng store type nÃ y cáº§n cÃ³ sáºµn cho selectors mÃ  báº¡n sá»­ dá»¥ng trong app. VÃ­ dá»¥, Ä‘Ã¢y lÃ  Ä‘á»‹nh nghÄ©a store Ä‘iá»ƒn hÃ¬nh cá»§a báº¡n:

```ts title="app/store/index.ts"
import { combineReducers, rootReducer } from "redux";

import { songReducer } from "entities/song";
import { artistReducer } from "entities/artist";

const rootReducer = combineReducers(songReducer, artistReducer);

const store = createStore(rootReducer);

type RootState = ReturnType<typeof rootReducer>;
type AppDispatch = typeof store.dispatch;
```

Sáº½ tá»‘t náº¿u cÃ³ typed Redux hooks `useAppDispatch` vÃ  `useAppSelector` trong `shared/store`, nhÆ°ng chÃºng khÃ´ng thá»ƒ import `RootState` vÃ  `AppDispatch` tá»« App layer do [import rule trÃªn layers][import-rule-on-layers]:

> Má»™t module trong slice chá»‰ cÃ³ thá»ƒ import cÃ¡c slices khÃ¡c khi chÃºng Ä‘Æ°á»£c Ä‘áº·t trÃªn layers nghiÃªm ngáº·t bÃªn dÆ°á»›i.

Giáº£i phÃ¡p Ä‘Æ°á»£c khuyáº¿n nghá»‹ trong trÆ°á»ng há»£p nÃ y lÃ  táº¡o implicit dependency giá»¯a layers Shared vÃ  App. Hai types nÃ y, `RootState` vÃ  `AppDispatch` khÃ´ng cháº¯c sáº½ thay Ä‘á»•i, vÃ  chÃºng sáº½ quen thuá»™c vá»›i Redux developers, vÃ¬ váº­y chÃºng ta khÃ´ng pháº£i lo láº¯ng vá» chÃºng nhiá»u.

Trong TypeScript, báº¡n cÃ³ thá»ƒ lÃ m Ä‘iá»u Ä‘Ã³ báº±ng cÃ¡ch khai bÃ¡o types lÃ  global nhÆ° tháº¿ nÃ y:

```ts title="app/store/index.ts"
/* cÃ¹ng ná»™i dung nhÆ° trong code block trÆ°á»›câ€¦ */

declare type RootState = ReturnType<typeof rootReducer>;
declare type AppDispatch = typeof store.dispatch;
```

```ts title="shared/store/index.ts"
import { useDispatch, useSelector, type TypedUseSelectorHook } from "react-redux";

export const useAppDispatch = useDispatch.withTypes<AppDispatch>()
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;
```

## Enums

Quy táº¯c chung vá»›i enums lÃ  chÃºng nÃªn Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a **cÃ ng gáº§n vá»›i vá»‹ trÃ­ sá»­ dá»¥ng cÃ ng tá»‘t**. Khi enum Ä‘áº¡i diá»‡n cho cÃ¡c giÃ¡ trá»‹ cá»¥ thá»ƒ cho má»™t feature duy nháº¥t, nÃ³ nÃªn Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong cÃ¹ng feature Ä‘Ã³.

Viá»‡c chá»n segment cÅ©ng nÃªn Ä‘Æ°á»£c quyáº¿t Ä‘á»‹nh bá»Ÿi vá»‹ trÃ­ sá»­ dá»¥ng. Náº¿u enum cá»§a báº¡n chá»©a, vÃ­ dá»¥, vá»‹ trÃ­ cá»§a toast trÃªn mÃ n hÃ¬nh, nÃ³ nÃªn Ä‘Æ°á»£c Ä‘áº·t trong segment `ui`. Náº¿u nÃ³ Ä‘áº¡i diá»‡n cho loading state cá»§a backend operation, nÃ³ nÃªn Ä‘Æ°á»£c Ä‘áº·t trong segment `api`.

Má»™t sá»‘ enums thá»±c sá»± chung cho toÃ n bá»™ dá»± Ã¡n, nhÆ° general backend response statuses hoáº·c design system tokens. Trong trÆ°á»ng há»£p nÃ y, báº¡n cÃ³ thá»ƒ Ä‘áº·t chÃºng trong Shared, vÃ  chá»n segment dá»±a trÃªn enum Ä‘áº¡i diá»‡n cho gÃ¬ (`api` cho response statuses, `ui` cho design tokens, v.v.).

## Type validation schemas vÃ  Zod

Náº¿u báº¡n muá»‘n validate ráº±ng dá»¯ liá»‡u cá»§a báº¡n phÃ¹ há»£p vá»›i hÃ¬nh dáº¡ng hoáº·c rÃ ng buá»™c nháº¥t Ä‘á»‹nh, báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a validation schema. Trong TypeScript, library phá»• biáº¿n cho cÃ´ng viá»‡c nÃ y lÃ  [Zod][ext-zod]. Validation schemas cÅ©ng nÃªn Ä‘Æ°á»£c colocated vá»›i code sá»­ dá»¥ng chÃºng, cÃ ng nhiá»u cÃ ng tá»‘t.

Validation schemas tÆ°Æ¡ng tá»± nhÆ° mappers (nhÆ° Ä‘Ã£ tháº£o luáº­n trong pháº§n [Data transfer objects vÃ  mappers](#data-transfer-objects-and-mappers)) á»Ÿ chá»— chÃºng nháº­n data transfer object vÃ  parse nÃ³, táº¡o ra lá»—i náº¿u parsing tháº¥t báº¡i.

Má»™t trong nhá»¯ng trÆ°á»ng há»£p phá»• biáº¿n nháº¥t cá»§a validation lÃ  cho dá»¯ liá»‡u Ä‘áº¿n tá»« backend. ThÃ´ng thÆ°á»ng, báº¡n muá»‘n request tháº¥t báº¡i khi dá»¯ liá»‡u khÃ´ng khá»›p vá»›i schema, vÃ¬ váº­y há»£p lÃ½ khi Ä‘áº·t schema á»Ÿ cÃ¹ng nÆ¡i vá»›i request function, thÆ°á»ng lÃ  segment `api`.

Náº¿u dá»¯ liá»‡u cá»§a báº¡n Ä‘áº¿n qua user input, nhÆ° form, validation nÃªn xáº£y ra khi dá»¯ liá»‡u Ä‘ang Ä‘Æ°á»£c nháº­p. Báº¡n cÃ³ thá»ƒ Ä‘áº·t schema trong segment `ui`, cáº¡nh form component, hoáº·c trong segment `model`, náº¿u segment `ui` quÃ¡ Ä‘Ã´ng.

## Typings cá»§a component props vÃ  context

NÃ³i chung, tá»‘t nháº¥t lÃ  giá»¯ props hoáº·c context interface trong cÃ¹ng file vá»›i component hoáº·c context sá»­ dá»¥ng chÃºng. Náº¿u báº¡n cÃ³ framework vá»›i single-file components, nhÆ° Vue hoáº·c Svelte, vÃ  báº¡n khÃ´ng thá»ƒ Ä‘á»‹nh nghÄ©a props interface trong cÃ¹ng file, hoáº·c báº¡n muá»‘n chia sáº» interface Ä‘Ã³ giá»¯a nhiá»u components, táº¡o file riÃªng trong cÃ¹ng folder, thÆ°á»ng lÃ  segment `ui`.

ÄÃ¢y lÃ  vÃ­ dá»¥ vá»›i JSX (React hoáº·c Solid):

```ts title="pages/home/ui/RecentActions.tsx"
interface RecentActionsProps {
  actions: Array<{ id: string; text: string }>;
}

export function RecentActions({ actions }: RecentActionsProps) {
  /* â€¦ */
}
```

VÃ  Ä‘Ã¢y lÃ  vÃ­ dá»¥ vá»›i interface Ä‘Æ°á»£c lÆ°u trong file riÃªng cho Vue:

```ts title="pages/home/ui/RecentActionsProps.ts"
export interface RecentActionsProps {
  actions: Array<{ id: string; text: string }>;
}
```

```html title="pages/home/ui/RecentActions.vue"
<script setup lang="ts">
  import type { RecentActionsProps } from "./RecentActionsProps";

  const props = defineProps<RecentActionsProps>();
</script>
```

## Ambient declaration files (`*.d.ts`)

Má»™t sá»‘ packages, vÃ­ dá»¥, [Vite][ext-vite] hoáº·c [ts-reset][ext-ts-reset], yÃªu cáº§u ambient declaration files Ä‘á»ƒ hoáº¡t Ä‘á»™ng trong app cá»§a báº¡n. ThÆ°á»ng thÃ¬ chÃºng khÃ´ng lá»›n hoáº·c phá»©c táº¡p, vÃ¬ váº­y chÃºng thÆ°á»ng khÃ´ng yÃªu cáº§u báº¥t ká»³ architecting nÃ o, cÃ³ thá»ƒ chá»‰ cáº§n Ä‘áº·t chÃºng trong folder `src/`. Äá»ƒ giá»¯ `src` cÃ³ tá»• chá»©c hÆ¡n, báº¡n cÃ³ thá»ƒ giá»¯ chÃºng trÃªn App layer, trong `app/ambient/`.

CÃ¡c packages khÃ¡c Ä‘Æ¡n giáº£n lÃ  khÃ´ng cÃ³ typings, vÃ  báº¡n cÃ³ thá»ƒ muá»‘n khai bÃ¡o chÃºng lÃ  untyped hoáº·c tháº­m chÃ­ viáº¿t typings riÃªng cho chÃºng. NÆ¡i tá»‘t cho nhá»¯ng typings Ä‘Ã³ sáº½ lÃ  `shared/lib`, trong folder nhÆ° `shared/lib/untyped-packages`. Táº¡o file `%LIBRARY_NAME%.d.ts` á»Ÿ Ä‘Ã³ vÃ  khai bÃ¡o types báº¡n cáº§n:

```ts title="shared/lib/untyped-packages/use-react-screenshot.d.ts"
// Library nÃ y khÃ´ng cÃ³ typings, vÃ  chÃºng tÃ´i khÃ´ng muá»‘n phiá»n viáº¿t riÃªng.
declare module "use-react-screenshot";
```

## Tá»± Ä‘á»™ng sinh types

ThÆ°á»ng xuyÃªn sinh types tá»« nguá»“n bÃªn ngoÃ i, vÃ­ dá»¥, sinh backend types tá»« OpenAPI schema. Trong trÆ°á»ng há»£p nÃ y, táº¡o nÆ¡i chuyÃªn dá»¥ng trong codebase cá»§a báº¡n cho nhá»¯ng types nÃ y, nhÆ° `shared/api/openapi`. LÃ½ tÆ°á»Ÿng nháº¥t, báº¡n cÅ©ng nÃªn bao gá»“m README trong folder Ä‘Ã³ mÃ´ táº£ nhá»¯ng files nÃ y lÃ  gÃ¬, cÃ¡ch tÃ¡i táº¡o chÃºng, v.v.

[import-rule-on-layers]: /docs/reference/layers#import-rule-on-layers
[ext-type-fest]: https://github.com/sindresorhus/type-fest
[ext-zod]: https://zod.dev
[ext-vite]: https://vitejs.dev
[ext-ts-reset]: https://www.totaltypescript.com/ts-reset
