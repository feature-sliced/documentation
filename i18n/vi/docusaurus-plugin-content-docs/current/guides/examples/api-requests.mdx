---
sidebar_position: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Xá»­ lÃ½ API Requests {#handling-api-requests}

## Shared API Requests {#shared-api-requests}

Báº¯t Ä‘áº§u báº±ng cÃ¡ch Ä‘áº·t logic API request chung trong thÆ° má»¥c `shared/api`. Äiá»u nÃ y giÃºp dá»… dÃ ng tÃ¡i sá»­ dá»¥ng cÃ¡c request trong toÃ n bá»™ á»©ng dá»¥ng vÃ  há»— trá»£ prototyping nhanh hÆ¡n. Äá»‘i vá»›i nhiá»u dá»± Ã¡n, Ä‘Ã¢y lÃ  táº¥t cáº£ nhá»¯ng gÃ¬ báº¡n cáº§n cho cÃ¡c API call.

Cáº¥u trÃºc file Ä‘iá»ƒn hÃ¬nh sáº½ lÃ :
- ğŸ“‚ shared
    - ğŸ“‚ api
        - ğŸ“„ client.ts
        - ğŸ“„ index.ts
        - ğŸ“‚ endpoints
            - ğŸ“„ login.ts

File `client.ts` táº­p trung thiáº¿t láº­p HTTP request cá»§a báº¡n. NÃ³ bao bá»c phÆ°Æ¡ng thá»©c báº¡n chá»n (nhÆ° `fetch()` hoáº·c má»™t instance `axios`) vÃ  xá»­ lÃ½ cÃ¡c cáº¥u hÃ¬nh chung, cháº³ng háº¡n nhÆ°:

- Backend base URL.
- Default headers (vÃ­ dá»¥, cho authentication).
- Data serialization.

DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c vÃ­ dá»¥ cho `axios` vÃ  `fetch`:

<Tabs>

<TabItem value="axios" label="Axios">
```ts title="shared/api/client.ts"
// Example using axios
import axios from 'axios';

export const client = axios.create({
  baseURL: 'https://your-api-domain.com/api/',
  timeout: 5000,
  headers: { 'X-Custom-Header': 'my-custom-value' }
});
```
</TabItem>

<TabItem value="fetch" label="Fetch">
```ts title="shared/api/client.ts"
export const client = {
  async post(endpoint: string, body: any, options?: RequestInit) {
    const response = await fetch(`https://your-api-domain.com/api${endpoint}`, {
      method: 'POST',
      body: JSON.stringify(body),
      ...options,
      headers: {
        'Content-Type': 'application/json',
        'X-Custom-Header': 'my-custom-value',
        ...options?.headers,
      },
    });
    return response.json();
  }
  // ... other methods like put, delete, etc.
};
```
</TabItem>

</Tabs>

Tá»• chá»©c cÃ¡c function API request riÃªng láº» cá»§a báº¡n trong `shared/api/endpoints`, nhÃ³m chÃºng theo API endpoint.

:::note

Äá»ƒ giá»¯ cÃ¡c vÃ­ dá»¥ táº­p trung, chÃºng tÃ´i bá» qua form interaction vÃ  validation. Äá»ƒ biáº¿t chi tiáº¿t vá» cÃ¡c thÆ° viá»‡n nhÆ° Zod hoáº·c Valibot, hÃ£y tham kháº£o bÃ i viáº¿t [Type Validation vÃ  Schemas](/docs/guides/examples/types#type-validation-schemas-and-zod).

:::

```ts title="shared/api/endpoints/login.ts"
import { client } from '../client';

export interface LoginCredentials {
  email: string;
  password: string;
}

export function login(credentials: LoginCredentials) {
  return client.post('/login', credentials);
}
```
Sá»­ dá»¥ng file `index.ts` trong `shared/api` Ä‘á»ƒ export cÃ¡c function request cá»§a báº¡n.

```ts title="shared/api/index.ts"
export { client } from './client'; // Náº¿u báº¡n muá»‘n export client
export { login } from './endpoints/login';
export type { LoginCredentials } from './endpoints/login';
```

## Slice-Specific API Requests {#slice-specific-api-requests}

Náº¿u má»™t API request chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi má»™t slice cá»¥ thá»ƒ (nhÆ° má»™t page hoáº·c feature Ä‘Æ¡n láº») vÃ  sáº½ khÃ´ng Ä‘Æ°á»£c tÃ¡i sá»­ dá»¥ng, hÃ£y Ä‘áº·t nÃ³ trong segment api cá»§a slice Ä‘Ã³. Äiá»u nÃ y giÃºp logic slice-specific Ä‘Æ°á»£c chá»©a Ä‘Ã³ng má»™t cÃ¡ch gá»n gÃ ng.

- ğŸ“‚ pages
    - ğŸ“‚ login
        - ğŸ“„ index.ts
        - ğŸ“‚ api
            - ğŸ“„ login.ts
        - ğŸ“‚ ui
            - ğŸ“„ LoginPage.tsx

```ts title="pages/login/api/login.ts"
import { client } from 'shared/api';

interface LoginCredentials {
  email: string;
  password: string;
}

export function login(credentials: LoginCredentials) {
  return client.post('/login', credentials);
}
```

Báº¡n khÃ´ng cáº§n export function `login()` trong public API cá»§a page, vÃ¬ khÃ´ng cÃ³ kháº£ nÄƒng nÆ¡i nÃ o khÃ¡c trong app sáº½ cáº§n request nÃ y.

:::note

TrÃ¡nh Ä‘áº·t API calls vÃ  response types trong layer `entities` quÃ¡ sá»›m. Backend responses cÃ³ thá»ƒ khÃ¡c vá»›i nhá»¯ng gÃ¬ frontend entities cá»§a báº¡n cáº§n. Logic API trong `shared/api` hoáº·c segment `api` cá»§a slice cho phÃ©p báº¡n transform data má»™t cÃ¡ch phÃ¹ há»£p, giá»¯ cho entities táº­p trung vÃ o cÃ¡c má»‘i quan tÃ¢m cá»§a frontend.

:::

## Sá»­ dá»¥ng Client Generators {#client-generators}

Náº¿u backend cá»§a báº¡n cÃ³ OpenAPI specification, cÃ¡c cÃ´ng cá»¥ nhÆ° [orval](https://orval.dev/) hoáº·c [openapi-typescript](https://openapi-ts.dev/) cÃ³ thá»ƒ generate API types vÃ  request functions cho báº¡n. Äáº·t code Ä‘Æ°á»£c generate trong, vÃ­ dá»¥, `shared/api/openapi`. Äáº£m báº£o bao gá»“m `README.md` Ä‘á»ƒ document nhá»¯ng types Ä‘Ã³ lÃ  gÃ¬ vÃ  cÃ¡ch generate chÃºng.

## TÃ­ch há»£p vá»›i Server State Libraries {#server-state-libraries}

Khi sá»­ dá»¥ng server state libraries nhÆ° [TanStack Query (React Query)](https://tanstack.com/query/latest) hoáº·c [Pinia Colada](https://pinia-colada.esm.dev/), báº¡n cÃ³ thá»ƒ cáº§n chia sáº» types hoáº·c cache keys giá»¯a cÃ¡c slices. Sá»­ dá»¥ng layer `shared` cho nhá»¯ng thá»© nhÆ°:

- API data types
- Cache keys
- Common query/mutation options

Äá»ƒ biáº¿t thÃªm chi tiáº¿t vá» cÃ¡ch lÃ m viá»‡c vá»›i server state libraries, hÃ£y tham kháº£o [bÃ i viáº¿t React Query](/docs/guides/tech/with-react-query) 