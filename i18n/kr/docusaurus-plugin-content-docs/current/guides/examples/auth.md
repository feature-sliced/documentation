---
sidebar_position: 1
sidebar_label: Authentication
---

# Authentication

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œì˜ **ì¸ì¦(Authentication)** í”Œë¡œìš°ëŠ” ë³´í†µ ë‹¤ìŒê³¼ ê°™ì€ ì„¸ ë‹¨ê³„ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.

1. **Credential ì…ë ¥ ìˆ˜ì§‘**â€‚â€”â€‚ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸(ë˜ëŠ” OAuth redirect URL)ë¥¼ ì‚¬ìš©ìì—ê²Œ ì…ë ¥ë°›ìŠµë‹ˆë‹¤.  
2. **ë°±ì—”ë“œ Endpoint í˜¸ì¶œ**â€‚â€”â€‚`/login`, `/oauth/callback`, `/2fa` ë“± ë¡œê·¸ì¸ ê´€ë ¨ API endpointë¡œ requestë¥¼ ë³´ëƒ…ë‹ˆë‹¤.  
3. **Token ì €ì¥**â€‚â€”â€‚ì‘ë‹µìœ¼ë¡œ ë°›ì€ tokenì„ **cookie** ë˜ëŠ” **store**ì— ì €ì¥í•´, ì´í›„ requestì— ìë™ìœ¼ë¡œ í¬í•¨ë˜ë„ë¡ í•©ë‹ˆë‹¤.

## 1. Credential ì…ë ¥ ìˆ˜ì§‘

ì´ ë‹¨ê³„ì—ì„œëŠ” ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì— í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆëŠ” UIë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.

> OAuth ë¡œê·¸ì¸ë§Œ ì‚¬ìš©í•œë‹¤ë©´, **2ë‹¨ê³„(credential ì „ì†¡)** ì—ì„œ ë³„ë„ë¡œ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³´ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤.  
> ì´ ê²½ìš° ë°”ë¡œ [token ì €ì¥](#how-to-store-the-token-for-authenticated-requests) ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.

### 1-1. ë¡œê·¸ì¸ ì „ìš© í˜ì´ì§€

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ **/login** ê°™ì€ ë¡œê·¸ì¸ Form ì „ìš© í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´, ì‚¬ìš©ìê°€ **ì‚¬ìš©ì ì´ë¦„ / ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸**ë¥¼ ì…ë ¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.

ì´ í˜ì´ì§€ëŠ” í•˜ëŠ” ì¼ì´ ë‹¨ìˆœí•˜ê¸° ë•Œë¬¸ì—, ì¶”ê°€ì ì¸ **decomposition(êµ¬ì¡° ë¶„í• )** ì´ í¬ê²Œ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ëŒ€ì‹ , ë¡œê·¸ì¸ í¼ê³¼ íšŒì›ê°€ì… í¼ì„ ê°ê° **í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸**ë¡œ ë§Œë“¤ì–´ ë‘ê³  ì¬ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ ì í•©í•©ë‹ˆë‹¤.


```bash
- ğŸ“‚ pages
    - ğŸ“‚ login
        - ğŸ“‚ ui
            - ğŸ“„ LoginPage.tsx (or your framework's component file format)
            - ğŸ“„ RegisterPage.tsx
        - ğŸ“„ index.ts
    - other pagesâ€¦
```

LoginPageì™€ RegisterPage ì»´í¬ë„ŒíŠ¸ëŠ” ì„œë¡œ **ë¶„ë¦¬** ëœ ì»´í¬ë„ŒíŠ¸ë¡œ êµ¬í˜„í•˜ê³ , ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš©í•  í•„ìš”ê°€ ìˆë‹¤ë©´ index.tsì—ì„œ export í•©ë‹ˆë‹¤.  
ê° ì»´í¬ë„ŒíŠ¸ëŠ” form elementì™€ form submit handlerë§Œ í¬í•¨í•˜ë„ë¡ í•´ì„œ,  
ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ë‹¤ë¥¸ segmentë¡œ ë¶„ë¦¬í•˜ê³  UIëŠ” ë‹¨ìˆœí•˜ê²Œ ìœ ì§€í•©ë‹ˆë‹¤.

### 1-2. ë¡œê·¸ì¸ dialog ë§Œë“¤ê¸°

ì–´ë–¤ í˜ì´ì§€ì—ì„œë“  ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¡œê·¸ì¸ dialogê°€ í•„ìš”í•˜ë‹¤ë©´, ì´ë¥¼ **ì¬ì‚¬ìš© ê°€ëŠ¥í•œ widget**ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.  
**widget**ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ í˜ì´ì§€ë§ˆë‹¤ ë¡œê·¸ì¸ ë¡œì§ì„ ë”°ë¡œ ë§Œë“¤ í•„ìš” ì—†ì´, í•„ìš”í•œ ê³³ì—ì„œ ë™ì¼í•œ dialogë¥¼ ë¶ˆëŸ¬ì™€ ì‚¬ìš©í•  ìˆ˜ ìˆê³ ,   
êµ¬ì¡°ë¥¼ ê³¼í•˜ê²Œ ìª¼ê°œì§€ ì•Šìœ¼ë©´ì„œë„ ì¬ì‚¬ìš©ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
- ğŸ“‚ widgets
    - ğŸ“‚ login-dialog
        - ğŸ“‚ ui
            - ğŸ“„ LoginDialog.tsx
        - ğŸ“„ index.ts
    - other widgetsâ€¦
```

> ì´í›„ ì„¤ëª…ì€ **ë¡œê·¸ì¸ ì „ìš© í˜ì´ì§€** ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰í•˜ì§€ë§Œ,  
> ì—¬ê¸°ì„œ ë‹¤ë£¨ëŠ” ì›ì¹™ì€ login dialog widgetì—ë„ ë™ì¼í•˜ê²Œ ì ìš©ë©ë‹ˆë‹¤.

### 1-3. Client-side Validation

íšŒì›ê°€ì… í˜ì´ì§€ì—ì„œ ì˜ëª»ëœ ì…ë ¥ì„ ì¦‰ì‹œ ì•Œë ¤ì£¼ë©´ UXê°€ í›¨ì”¬ ì¢‹ì•„ì§‘ë‹ˆë‹¤.  
ì´ë¥¼ ìœ„í•´ client-side validationì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²€ì¦ ê·œì¹™ì€ `pages/login/model` segmentì— schema í˜•íƒœë¡œ ì •ì˜í•˜ê³ ,`ui` segmentì—ì„œëŠ” ì´ schemaë¥¼ ë¶ˆëŸ¬ì™€ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.  
ì•„ë˜ ì˜ˆì‹œëŠ” [Zod][ext-zod]ë¥¼ ì‚¬ìš©í•´ íƒ€ì…ê³¼ ê°’ì„ ë™ì‹œì— ê²€ì¦í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

```ts title="pages/login/model/registration-schema.ts"
import { z } from "zod";

export const registrationData = z.object({
    email: z.string().email(),
    password: z.string().min(6),
    confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
    message: "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤",
    path: ["confirmPassword"],
});
```

ê·¸ëŸ° ë‹¤ìŒ, `ui` segmentì—ì„œ ì´ schemaë¥¼ ì‚¬ìš©í•´ formìœ¼ë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```tsx title="pages/login/ui/RegisterPage.tsx"
import { registrationData } from "../model/registration-schema";

function validate(formData: FormData) {
    const data = Object.fromEntries(formData.entries());
    try {
        registrationData.parse(data);
    } catch (error) {
        // TODO: Show error message to the user
    }
}

export function RegisterPage() {
    return (
        <form onSubmit={(e) => validate(new FormData(e.target))}>
            <label htmlFor="email">ì´ë©”ì¼</label>
            <input id="email" name="email" required />

            <label htmlFor="password">ë¹„ë°€ë²ˆí˜¸ (ìµœì†Œ 6ì)</label>
            <input id="password" name="password" type="password" required />

            <label htmlFor="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input id="confirmPassword" name="confirmPassword" type="password" required />
        </form>
    )
}
```

## 2. Send credentials

ì´ ë‹¨ê³„ì—ì„œëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ **credentials**(e-mail, password ë“±)ë¥¼  
ë°±ì—”ë“œ **endpoint**ë¡œ ì „ì†¡í•˜ëŠ” **request í•¨ìˆ˜**ë¥¼ ë§Œë“­ë‹ˆë‹¤.

ì´ í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³³ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Zustand  
- Redux Toolkit  
- TanStack Queryì˜ useMutation  
- ê¸°íƒ€ state ê´€ë¦¬/ìš”ì²­ ë¡œì§  

ì¦‰, **ì–´ë””ì—ì„œë‚˜ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¡œê·¸ì¸ ìš”ì²­ í•¨ìˆ˜** ë¥¼ ë§Œë“ ë‹¤ê³  ë³´ë©´ ë©ë‹ˆë‹¤.

### 2-1. í•¨ìˆ˜ placement

| ëª©ì         | ê¶Œì¥ ìœ„ì¹˜         | ì´ìœ                        |
| ----------- | ----------------- | -------------------------- |
| ì „ì—­ ì¬ì‚¬ìš© | shared/api        | ëª¨ë“  sliceì—ì„œ import ê°€ëŠ¥ |
| ë¡œê·¸ì¸ ì „ìš© | pages/login/api   | slice ë‚´ë¶€ capsule ìœ ì§€    |

#### shared/apiì— ì €ì¥í•˜ê¸°

ë¡œê·¸ì¸ë¿ ì•„ë‹ˆë¼ ëª¨ë“  API requestë¥¼ shared/apiì— ëª¨ì•„ë‘ê³ ,  
ê° ìš”ì²­ì„ endpointë³„ë¡œ ê·¸ë£¹í™”í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

```bash
- ğŸ“‚ shared
    - ğŸ“‚ api
        - ğŸ“‚ endpoints
            - ğŸ“„ login.ts
            - other endpoint functionsâ€¦
        - ğŸ“„ client.ts
        - ğŸ“„ index.ts
```

`ğŸ“„ client.ts`ëŠ” ì›ì‹œ request í•¨ìˆ˜(`fetch` ë“±)ë¥¼ ê°ì‹¼ ê³µìš© API clientë¡œ,  
**ê¸°ë³¸ URL, ê³µí†µ í—¤ë”, request/response ì§ë ¬í™”** ë“±ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```ts title="shared/api/endpoints/login.ts"
import { POST } from "../client";

export function login({ email, password }: { email: string, password: string }) {
    return POST("/login", { email, password });
}
```

```ts title="shared/api/index.ts"
export { login } from "./endpoints/login";
```

#### pageì˜ api segmentì— ì €ì¥í•˜ê¸°

ë¡œê·¸ì¸ requestê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤ë©´,  
í•´ë‹¹ í˜ì´ì§€ì˜ api segmentì— login í•¨ìˆ˜ë¥¼ ë‘ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```bash
- ğŸ“‚ pages
    - ğŸ“‚ login
        - ğŸ“‚ api
            - ğŸ“„ login.ts
        - ğŸ“‚ ui
            - ğŸ“„ LoginPage.tsx
        - ğŸ“„ index.ts
    - other pagesâ€¦
```

```ts title="pages/login/api/login.ts"
import { POST } from "shared/api";

export function login({ email, password }: { email: string, password: string }) {
    return POST("/login", { email, password });
}
```

> ì´ í•¨ìˆ˜ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ,  
> index.tsì—ì„œ ë‹¤ì‹œ exportí•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

### Two-Factor Auth (2FA)

2ë‹¨ê³„ ì¸ì¦(2FA)ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” ë¡œê·¸ì¸ í”Œë¡œìš°ì— í•œ ë‹¨ê³„ê°€ ë” ì¶”ê°€ë©ë‹ˆë‹¤.

1. `/login` ì‘ë‹µì— `has2FA` í”Œë˜ê·¸ê°€ ìˆìœ¼ë©´, `/login/2fa` í˜ì´ì§€ë¡œ redirect í•©ë‹ˆë‹¤.  
2. 2FA í˜ì´ì§€ì™€ ê´€ë ¨ APIë“¤ì€ ëª¨ë‘ `pages/login` sliceì— í•¨ê»˜ ë‘¡ë‹ˆë‹¤.  
3. `/2fa/verify`ì™€ ê°™ì´ ë³„ë„ì˜ endpointë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ëŠ” `shared/api` ë˜ëŠ” `pages/login/api`ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´, ì¼ë°˜ ë¡œê·¸ì¸ê³¼ 2FA ê´€ë ¨ ë¡œì§ì„ **login slice ë‚´ë¶€**ì— ëª¨ì•„ë‘˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Authenticated Requestsë¥¼ ìœ„í•œ token ì €ì¥ {#how-to-store-the-token-for-authenticated-requests}

ë¡œê·¸ì¸, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½, OAuth, 2ë‹¨ê³„ ì¸ì¦ ë“± ì–´ë–¤ ë°©ë²•ìœ¼ë¡œ ì¸ì¦ì„ í•˜ë“ ,  
ì¸ì¦ API í˜¸ì¶œì˜ **ì‘ë‹µ(response)** ìœ¼ë¡œ ë³´í†µ tokenì´ í•¨ê»˜ ë‚´ë ¤ì˜µë‹ˆë‹¤.

ì´ tokenì„ ì–´ë”˜ê°€ì— ì €ì¥í•´ ë‘ë©´,  
ì´í›„ **ëª¨ë“  ì¸ì¦ì´ í•„ìš”í•œ API ìš”ì²­(request)** ì— tokenì„ ìë™ìœ¼ë¡œ í¬í•¨ì‹œì¼œ ë°±ì—”ë“œ ì¸ì¦ì„ í†µê³¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ tokenì„ ì €ì¥í•˜ëŠ” ë°©ë²• ì¤‘ **ê°€ì¥ ê¶Œì¥ë˜ëŠ” ë°©ì‹ì€ cookie**ì…ë‹ˆë‹¤.

cookieë¥¼ ì‚¬ìš©í•˜ë©´, ë¸Œë¼ìš°ì €ê°€ ìš”ì²­ë§ˆë‹¤ tokenì„ ìë™ìœ¼ë¡œ ë„£ì–´ ì£¼ê¸° ë•Œë¬¸ì—  
í”„ë¡ íŠ¸ì—”ë“œì—ì„œ tokenì„ ì§ì ‘ ê´€ë¦¬í•  í•„ìš”ê°€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.  
ë”°ë¼ì„œ í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜ ì°¨ì›ì—ì„œ ì‹ ê²½ ì“¸ ë¶€ë¶„ì´ í¬ê²Œ ì¤„ì–´ë“­ë‹ˆë‹¤.

ì‚¬ìš© ì¤‘ì¸ í”„ë ˆì„ì›Œí¬ê°€ ì„œë²„ ì‚¬ì´ë“œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ë©´(ì˜ˆ: [Remix][ext-remix]),  
ì„œë²„ ì¸¡ cookie ê´€ë ¨ ë¡œì§ì„ shared/apiì— ë‘ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.  

Remixì—ì„œì˜ êµ¬í˜„ ì˜ˆì‹œëŠ” [íŠœí† ë¦¬ì–¼ì˜ Authentication ì„¹ì…˜][tutorial-authentication]ì„ ì°¸ê³ í•˜ë©´ ë©ë‹ˆë‹¤.

í•˜ì§€ë§Œ cookieë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í™˜ê²½ë„ ìˆìŠµë‹ˆë‹¤.  
ì´ ê²½ìš°ì—ëŠ” tokenì„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ ì €ì¥í•˜ê³ , token ë§Œë£Œë¥¼ ê°ì§€í•˜ê³ ,  
refresh tokenì„ ì‚¬ìš©í•´ ìƒˆ tokenì„ ë°œê¸‰ë°›ê³  ê¸°ì¡´ ìš”ì²­ì„ ë‹¤ì‹œ ì‹¤í–‰í•˜ëŠ” ë“±ì˜ ë¡œì§ì„ í•¨ê»˜ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.

FSDì—ì„œëŠ” ì—¬ê¸°ì„œ í•œ ê°€ì§€ ì¶”ê°€ ê³ ë¯¼ì´ í•„ìš”í•©ë‹ˆë‹¤.  

tokenì„ **ì–´ëŠ layer ë˜ëŠ” ì–´ëŠ segmentì—** ì €ì¥í• ì§€,  
ê·¸ë ‡ê²Œ ì €ì¥í•œ tokenì„ ì•± ì „ì—­ì—ì„œ **ì–´ë–»ê²Œ** ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í• ì§€ì— ë”°ë¼ ì „ì²´ êµ¬ì¡°ê°€ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

### 3-1. Shared

Shared layerì— tokenì„ ë‘ëŠ” ë°©ì‹ì€ shared/apiì— ì •ì˜ëœ **ê³µìš© API í´ë¼ì´ì–¸íŠ¸**ì™€ ìì—°ìŠ¤ëŸ½ê²Œ ê²°í•©ë˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

tokenì„ module scopeë‚˜ ì–´ë–¤ reactive storeì— ì €ì¥í•´ ë‘ë©´,  
ì¸ì¦ì´ í•„ìš”í•œ ë‹¤ë¥¸ API í•¨ìˆ˜ì—ì„œ ì´ tokenì„ **ê·¸ëŒ€ë¡œ ì°¸ì¡°**í•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

token ìë™ ì¬ë°œê¸‰(refresh)ì€ API clientì˜ **middleware**ì—ì„œ ë‹´ë‹¹í•©ë‹ˆë‹¤.

1. ë¡œê·¸ì¸ ì‹œ **access token, refresh token**ì„ ì €ì¥í•©ë‹ˆë‹¤.  
2. ì¸ì¦ì´ í•„ìš”í•œ requestë¥¼ ë³´ëƒ…ë‹ˆë‹¤.  
3. ì‘ë‹µì—ì„œ token ë§Œë£Œ ì½”ë“œë¥¼ ë°›ìœ¼ë©´, refresh tokenìœ¼ë¡œ ìƒˆ tokenì„ ë°œê¸‰í•´ ì €ì¥í•œ ë’¤ ì‹¤íŒ¨í•œ requestì„ ë™ì¼í•˜ê²Œ ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.

#### Token ê´€ë¦¬ ë¶„ë¦¬ ì „ëµ

- **ì „ë‹´ segment ë¶€ì¬**  
  token ì €ì¥ê³¼ ì¬ë°œê¸‰ ë¡œì§ì´ request ë¡œì§ê³¼ ê°™ì€ íŒŒì¼ì— ë’¤ì„ì—¬ ìˆìœ¼ë©´, ì½”ë“œê°€ ë§ì•„ì§ˆìˆ˜ë¡ ìœ ì§€ë³´ìˆ˜ê°€ ì ì  ì–´ë ¤ì›Œì§‘ë‹ˆë‹¤.  
  ì´ëŸ° ê²½ìš°ì—ëŠ” **request í•¨ìˆ˜ì™€ clientëŠ” `shared/api`ì— ë‘ê³ **,  
  **token ê´€ë¦¬ ë¡œì§ì€ `shared/auth` segmentë¡œ ë¶„ë¦¬**í•˜ëŠ” ë°©ì‹ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

- **tokenê³¼ ì‚¬ìš©ì ì •ë³´ë¥¼ í•¨ê»˜ ë°›ëŠ” ê²½ìš°**  
  ë°±ì—”ë“œê°€ tokenê³¼ ë™ì‹œì— **í˜„ì¬ ì‚¬ìš©ì ì •ë³´**ë¥¼ ë°˜í™˜í•˜ëŠ” APIë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.  
  ì´ë•ŒëŠ” ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  1. ë³„ë„ storeì— í•¨ê»˜ ì €ì¥í•˜ê±°ë‚˜  
  2. `/me`Â·`/users/current` ê°™ì€ endpointë¥¼ ë”°ë¡œ í˜¸ì¶œí•´ user ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 3-2. Entities

FSD í”„ë¡œì íŠ¸ì—ì„œëŠ” ë³´í†µ **User entity**(ë˜ëŠ” **Current User entity**)ë¥¼ ë‘ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.  
ë‘ entityë¥¼ í•˜ë‚˜ë¡œ í•©ì³ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ì „í˜€ ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤.

:::note

**Current User**ëŠ” `viewer` ë˜ëŠ” `me`ë¼ê³  ë¶€ë¥´ê¸°ë„ í•©ë‹ˆë‹¤.  
ì´ëŠ” ê¶Œí•œê³¼ ê°œì¸ ì •ë³´ê°€ ìˆëŠ” **í˜„ì¬ ë¡œê·¸ì¸í•œ ë‹¨ì¼ ì‚¬ìš©ì**ì™€,  
ê³µê°œì ìœ¼ë¡œ í‘œì‹œë˜ëŠ” **ì—¬ëŸ¬ ì‚¬ìš©ì ëª©ë¡**ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì“°ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.

:::

#### Tokenì„ User Entitiesì— ì €ì¥í•˜ê¸°

User entityì˜ model segmentì— **reactive store**ë¥¼ ë§Œë“¤ê³ ,  
ì´ê³³ì— tokenê³¼ user ê°ì²´ë¥¼ í•¨ê»˜ ë³´ê´€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´: **í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´** ì™€ **ê·¸ ì‚¬ìš©ìê°€ ê°€ì§„ token**ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ì„œ,  
ì¸ì¦ê³¼ ê´€ë ¨ëœ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì‘ì„±í•  ë•Œ êµ¬ì¡°ë¥¼ ì´í•´í•˜ê¸° ì‰¬ì›Œì§‘ë‹ˆë‹¤.

ë‹¤ë§Œ API clientëŠ” ë³´í†µ shared/apiì— ì •ì˜ë˜ê±°ë‚˜,  
ì—¬ëŸ¬ entityì— ë¶„ì‚°ë˜ì–´ ìˆëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.  

ë”°ë¼ì„œ layerì˜ import ê·œì¹™([import rule on layers][import-rule-on-layers])ì„ ì§€í‚¤ë©´ì„œë„ ë‹¤ë¥¸ requestì—ì„œ ì´ tokenì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

> Layer ê·œì¹™ â€” Sliceì˜ moduleì€ **ìê¸°ë³´ë‹¤ ì•„ë˜ layer**ì˜ Sliceë§Œ importí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

##### í•´ê²° ë°©ë²•

1. **requestë§ˆë‹¤ tokenì„ ì§ì ‘ ë„˜ê¸°ê¸°**  
   - êµ¬í˜„ì€ ë‹¨ìˆœí•˜ì§€ë§Œ ì½”ë“œê°€ ë°˜ë³µë˜ê¸° ì‰½ê³ , íƒ€ì… ì•ˆì „ì„±ì´ ì—†ìœ¼ë©´ ì‹¤ìˆ˜ ê°€ëŠ¥ì„±ì´ ì»¤ì§‘ë‹ˆë‹¤.  
   - shared/apiì— middleware patternì„ ì ìš©í•˜ê¸°ë„ ì–´ë µìŠµë‹ˆë‹¤.

2. **ì•± ì „ì—­(Context / localStorage)ì— ë…¸ì¶œ**  
   - token keyëŠ” shared/apiì— ë‘ê³ , ì‹¤ì œ token ê°’ì´ ë‹´ê¸´ storeëŠ” User entityì—ì„œ export í•©ë‹ˆë‹¤.  
   - Context ProviderëŠ” App layerì— ë°°ì¹˜í•©ë‹ˆë‹¤.  
   - ì„¤ê³„ ììœ ë„ê°€ ë†’ì§€ë§Œ, ìƒìœ„ layerì— **ì•”ë¬µì  ì˜ì¡´ì„±**ì´ ìƒê¹ë‹ˆë‹¤.  
   â‡’ Contextë‚˜ localStorageê°€ ëˆ„ë½ëœ ê²½ìš° **ëª…í™•í•œ ì—ëŸ¬**ë¥¼ ë‚´ë„ë¡ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

3. **tokenì´ ë°”ë€” ë•Œë§ˆë‹¤ API í´ë¼ì´ì–¸íŠ¸ì— ì—…ë°ì´íŠ¸**  
   - store **subscription**ìœ¼ë¡œ "token ë³€ê²½ â†’ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸â€ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
   - ë°©ë²• 2ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì•”ë¬µì  ì˜ì¡´ì„±ì´ ìˆìœ¼ë‚˜,  
     - ë°©ë²• 2ëŠ” í•„ìš”í•  ë•Œ ê°’ì„ **ê°€ì ¸ì˜¤ëŠ”(pull)** ë°©ì‹ì´ê³ ,  
     - ë°©ë²• 3ì€ ë³€ê²½ë  ë•Œ ê°’ì„ **ë°€ì–´ë„£ëŠ”(push)** ë°©ì‹ì…ë‹ˆë‹¤.

tokenì„ ì´ë ‡ê²Œ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë…¸ì¶œí•œ ë’¤ì—ëŠ”  
model segmentì— **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ì„ ë” ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

ì˜ˆë¥¼ ë“¤ë©´, token ë§Œë£Œ ì‹œê°„ì— ë§ì¶° ìë™ìœ¼ë¡œ ê°±ì‹ í•˜ê±°ë‚˜,  
ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ tokenì„ ìë™ìœ¼ë¡œ ë¬´íš¨í™”í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ì œ ë°±ì—”ë“œ í˜¸ì¶œì€ **User entityì˜ api segment** ë˜ëŠ” shared/apiì—ì„œ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### 3-3. Pages / Widgets â€” ê¶Œì¥í•˜ì§€ ì•ŠìŒ

ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë¡œ page layerë‚˜ widget layerì— tokenì„ ì €ì¥í•˜ëŠ” ê²ƒì€ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  

page, widget layerì— tokenì„ ë‘ë©´ ì „ì—­ì—ì„œ ì´ tokenì— ì˜ì¡´í•˜ê²Œ ë˜ëŠ”ë°,  
ì´ë ‡ê²Œ ë˜ë©´ ë‹¤ë¥¸ sliceì—ì„œ ì¬ì‚¬ìš©í•˜ê¸° ì–´ë µê³ , êµ¬ì¡°ê°€ ì‰½ê²Œ ì–½í™ë‹ˆë‹¤.  

ë”°ë¼ì„œ token ì €ì¥ ìœ„ì¹˜ëŠ” Shared ë˜ëŠ” Entities ì¤‘ í•˜ë‚˜ë¡œ ê²°ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

## 4. Logout & Token Invalidation

### ë¡œê·¸ì•„ì›ƒê³¼ token ë¬´íš¨í™”

ëŒ€ë¶€ë¶„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” **ë¡œê·¸ì•„ì›ƒ ì „ìš© í˜ì´ì§€**ëŠ” ë”°ë¡œ ë‘ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ëŒ€ì‹ , ì–´ëŠ í™”ë©´ì—ì„œë“  í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì„ ë‘ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.

ë¡œê·¸ì•„ì›ƒì€ ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒ ë‘ ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

1. ë°±ì—”ë“œì— ì¸ì¦ëœ ë¡œê·¸ì•„ì›ƒ request ë³´ë‚´ê¸° (ì˜ˆ: `POST /logout`)  
2. token store reset (access token / refresh token ëª¨ë‘ ì œê±°)  

> ëª¨ë“  API requestì„ shared/apiì— ëª¨ì•„ ê´€ë¦¬í•˜ê³  ìˆë‹¤ë©´,  
> ë¡œê·¸ì•„ì›ƒ APIëŠ” login() ê·¼ì²˜, ì˜ˆë¥¼ ë“¤ì–´ shared/api/endpoints/logout.tsì— ë‘ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.  
>
> ë°˜ëŒ€ë¡œ íŠ¹ì • UI(ì˜ˆ: Header)ì—ë§Œ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì´ ìˆê³ ,  
> ê·¸ê³³ì—ì„œë§Œ ì´ APIë¥¼ í˜¸ì¶œí•œë‹¤ë©´ widgets/header/api/logout.tsì²˜ëŸ¼  
> ë²„íŠ¼ì´ ìœ„ì¹˜í•œ widget ê·¼ì²˜ì— ë‘ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

token store resetì€ ì‹¤ì œë¡œ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ê°€ì§„ UIì—ì„œ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.  
ë¡œê·¸ì•„ì›ƒ requestì™€ store resetì„ ê°™ì€ widgetì˜ model segmentì— í•¨ê»˜ ë‘ì–´ë„ ë©ë‹ˆë‹¤.

### ìë™ ë¡œê·¸ì•„ì›ƒ

ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì—ëŠ” ë°˜ë“œì‹œ token storeë¥¼ ì´ˆê¸°í™”í•´ì•¼ í•©ë‹ˆë‹¤.

- ë¡œê·¸ì•„ì›ƒ requestê°€ ì‹¤íŒ¨í–ˆì„ ë•Œ  
- ë¡œê·¸ì¸ token ê°±ì‹ (`/refresh`)ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ  

ì´ ìƒí™©ì—ì„œ tokenì´ ê·¸ëŒ€ë¡œ ë‚¨ì•„ ìˆìœ¼ë©´,  
í™”ë©´ ìƒìœ¼ë¡œëŠ” **ë¡œê·¸ì¸ëœ ê²ƒì²˜ëŸ¼** ë³´ì´ì§€ë§Œ ì‹¤ì œë¡œëŠ” ëŒ€ë¶€ë¶„ì˜ ìš”ì²­ì´ ì‹¤íŒ¨í•˜ëŠ” ì• ë§¤í•œ ìƒíƒœê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> tokenì„ Entities(User)ì— ë³´ê´€í–ˆë‹¤ë©´,  
> í•´ë‹¹ entityì˜ model segmentì— token ì´ˆê¸°í™” ì½”ë“œë¥¼ ë‘ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.  
> Shared layerì—ì„œ tokenì„ ê´€ë¦¬í•œë‹¤ë©´, shared/auth segmentë¡œ ë¶„ë¦¬í•´ ë‘ëŠ” ê²ƒë„ ì¢‹ì€ ì„ íƒì…ë‹ˆë‹¤.

[tutorial-authentication]: /docs/get-started/tutorial#authentication  
[import-rule-on-layers]: /docs/reference/layers#import-rule-on-layers  
[ext-remix]: https://remix.run  
[ext-zod]: https://zod.dev
